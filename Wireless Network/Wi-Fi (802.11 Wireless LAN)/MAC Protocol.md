-----
### 802.11 MAC 프로토콜
-----
1. 무선 스테이션이 AP에 결합되면, AP와 데이터 프레임을 송수신할 수 있음
2. 그러나 AP 자신을 포함한 여러 스테이션이 동시에 동일한 채널로 데이터 프레임을 전송할 수도 있으므로 전송을 조정하기 위해 다중 접속 프로토콜이 필요
   - 무선 스테이션이란 다중 접속 채널을 공유하는 무선 장치 또는 AP를 의미
   - 다중 접속 프로토콜은 크게 3가지 방법이 있는데, 채널 분할 / 랜덤 접속 / 순번제가 존재
   - 802.11 무선 랜에서는 랜덤 접속 프로토콜을 사용 : CSMA/CA 방식 사용
   - 즉, 스테이션이 채널을 전송하기 전에 채널 상태를 먼저 감지하고(Sense), 만일 채널이 사용 중이면 전송하지 않음
     + 이더넷과 802.11 모두 채널을 감지하는 랜덤 접속 프로토콜을 사용하지만 MAC 프로토콜에 중요 차이가 존재
     + 802.11은 충돌 검출(Collision Detection)을 사용하지 않고, 충돌 회피(Collsion Avoidance) 기술을 사용
     + 무선 채널의 비트 오류율이 상대적으로 크므로 이더넷과 달리 802.11에서는 링크 계층의 ARQ(ACK / 재전송) 방식을 사용
    
3. 이더넷의 스테이션은 전송하면서 동시에 채널을 감지함
   - 전송 도중에 또 다른 기지국이 동시에 전소앟는 것을 감지하면 스테이션은 전송을 중단하고 임의의 시간만큼 기다린 후 다시 전송을 시도
   - 802.11 MAC 프로토콜이 충돌 검출을 구현하지 않는 이유
     + 충돌 검출을 하려면 (스테이션 자신의 신호) 송신과 (다른 스테이션 전송 여부 결정을 위한) 수신이 동시에 가능해야 하며, 일반적으로 802.11 어댑터에서 수신 신호의 세기는 송신 신호의 세기에 비해 아주 약하므로, 송수신을 모두 고려하여 충돌을 검출할 수 있는 하드웨어를 만드는 데 많은 비용이 듬
     + 더 중요한 이유로서, 동시에 송수신이 가능하고 다른 스테이션에 의한 채널 사용을 감지했을 때 전송을 중단할 수 있다고 하더라도, 숨은 터미널 문제와 페이딩 때문에 충돌을 검출하지 못할 수 있음

   - 802.11 무선 랜은 충돌 검출을 사용하지 않으므로, 스테이션이 프레임을 전송하기 시작하면 일단 그 프레임을 모두 전송
     + 즉, 일단 스테이션이 전송하기 시작하면 중단할 수 없으며, 충돌이 빈번할 때, 프레임(특히 큰 프레임) 전체를 전송하면 다중 접속 프로토콜의 성능이 상당히 저하될 수 있음
     + 충돌 가능성을 감소시키기 위해 802.11은 충돌 회피 기술을 사용

4. 802.11의 링크 계층 ACK 방법
   - 무선 랜에서 송신 스테이션이 전송한 프레임은 여러 가지 이유로 목적지 스테이션에 제대로 도달하지 못할 수 있음
   - 이 문제를 해결하기 위해 802.11 MAC에서는 링크 계층 ACK를 사용
<div align="center">
<img src="https://github.com/user-attachments/assets/238c4ca8-c7f7-4e9e-815a-1573571aed32">
</div>

   - 목적지 스테이션은 CRC 검사를 통과한 프레임을 수신하면 SIFS(Short Inter-Frame Spacing)라는 짧은 시간을 기다린 후에 ACK 프레임을 송신 스테이션에게 보냄
   - 만일 송신 스테이션이 주어진 시간 동안 ACK를 수신하지 못하면, 송신 스테이션은 오류가 발생했다고 가정하고 다시 CSMA/CA 프로토콜을 사용해서 채널 접속을 한 후 프레임을 재전송
   - 만일 일정 횟수만큼 재전송 후에도 ACK를 수신하지 못하면, 송신 스테이션은 포기하고 프레임을 폐기

5. 802.11 CSMA/CA 프로토콜 (스테이션(무선 장치나 AP)이 전송할 프레임을 가졌다고 가정)
   - 스테이션은 채널이 사용되지 않음을 감지하면 DIFS(Distributed Inter-Frame Space)라는 짧은 시간 동안 기다린 후에 프레임을 전송
   - 그렇지 않고 채널이 사용 중이면, 스테이션은 백오프 방식에 따라 선택된 임의 시간 동안 대기 : DIFS 시간 이후 채널이 사용되지 않음을 감지하면 선택된 시간의 카운터 값은 감소하며, 채널 사용이 감지되면 카운터 값은 그대로 고정
   - 카운터가 0에 도달하면(채널이 사용되지 않을때만 가능), 스테이션은 프레임 전체를 전송한 후 ACK를 기다림
   - ACK를 수신하면, 송신 스테이션은 프레임이 목적지 스테이션에 의해 제대로 수신되었음을 알게 됨 : 만일 스테이션에 전송할 프레임이 또 있다면, 2단계의 CSMA/CA 프로토콜이 수행 (만일 ACK를 수신하지 못하면, 송신 스테이션은 좀 더 증가된 임의의 시간값을 선택한 후 2단계 백오프 과정 수행)

6. 이더넷의 CSMA/CD 다중 프로토콜에서는 채널이 사용되지 않는 유휴 상태임을 감지한 스테이션은 바로 전송을 시작하지만, CSMA/CA 프로토콜에서는 채널이 사용되지 않는 상태임을 감지하더라도 스테이션은 임의의 백오프 값을 선택하여 카운트 다운 과정을 거치므로 전송을 지연
   - 각 전송할 프레임을 가진 2개의 스테이션 또 다른 제3의 스테이션이 이미 전송하고 있음을 감지했기 때문에 바로 전송하지 않는 상황을 생각
   - 이더넷 CSMA/CD에서는 전송 중이었던 스테이션이 전송을 마치면 이 두스테이션이 바로 전송을 시작하며, 이 경우에 충돌이 발생하며, CSMA/CD에서는 두 스테이션 모두 전송을 즉시 중단
     + 따라서, 충돌을 겪은 프레임의 나머지 부분을 전송하지 않음으로, 불필요한 전송을 피하므로 문제가 심각해지지 않음
   - 802.11에서는 충돌을 검출하지 않으므로, 전송을 중단하지 않으므로, 충돌을 겪은 프레임이라도 전체를 다 전송
     + 따라서, 가능한 한 충돌을 회피하는 것
     + 802.11의 경우 두 스테이션이 채널이 현재 사용 중임을 감지하면 이들은 서로 다른 백오프 시간이 선택되기를 기대하면서 랜덤 백오프 기법을 수행
     + 선택된 백오프 시간이 다를 경우, 채널이 사용되지 않는 유휴 상태에 도달했을 때 경쟁 중인 두 스테이션 중 하나가 다른 스테이션보다 먼저 전송을 시작하며, (만일 두 스테이션이 모두 서로로부터 숨은 터미널이 아니라면) 경쟁에 진 스테이션은 경쟁에서 이긴 스테이션의 신호를 감지하고, 자신의 카운터를 멈춘 뒤 경쟁에 이겨 전송 기회를 획득한 스테이션이 전송을 완료할 때까지 기다림
     + 이런 방식으로 충돌을 회피하며, 두 스테이션이 서로 숨은 터미널이거나 두 스테이션이 선택한 임의의 백오프값이 너무 가까울 경우 충돌이 생길 수 있음
  
