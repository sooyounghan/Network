-----
### 이동 장치로서 직접 라우팅과 간접 라우팅
-----
1. 인터넷에 연결된 한 호스트
<div align="center">
<img src="https://github.com/user-attachments/assets/dca7f6da-f71d-4185-922f-468391d9b56c">
</div>

   - 이 호스트는 통신자(Correspondent)라고 불리며, 홈 네트워크에 있거나 또는 방문 네트워크에 로밍 중인 어떤 이동 장치와 통신하기를 원함
   - 모든 이동 장치에는 전역적으로 고유한 식별자가 있다고 가정 (4G LTE 셀룰러 네트워크에서 이 식별자는 IMSI와 관련 전화 번호이며, 이 정보는 SIM 카드에 저장되고, 인터넷 사용자의 경우 이 식별자는 이동 IP 구조와 마찬가지로 홈 네트워크 주소 범위에 있는 영구적인 IP 주소)

2. 기존 IP 주소 인프라 활용
   - 방문 네트워크에 있는 이동 장치로 라우팅하는 가장 간단한 방법 : 기존 IP 주소 체계를 이용하는 것 (IP 주소 인프라에 새로운 것을 추가할 필요가 없음)
   - ISP는 BGP를 통해 도달 가능한 네트워크의 CIDR화된 주소 범위를 열거해 목적지 네트워크에 대한 경로를 광고
   - 방문 네트워크는 매우 구체적인 주소를 광고함으로써 특정 이동 장치가 자신의 네트워크에 존재한다는 사실을 다른 모든 네트워크에게 알릴 수 있음
   - 즉, 이동 장치의 영구적인 32비트 IP 주소를 광고하여 데이터그램을 해당 이동 장치로 전달하는데 사용할 경로가 있음을 다른 네트워크들에게 알리는 것
   - 이후, 인접 네트워크들은 라우팅 정보 및 포워딩 테이블을 갱신하는 일반적인 BGP 절차를 사용해 네트워크 전체에 이 정보를 전파
   - 데이터그램은 항상 해당 주소에 대한 가장 구체적인 목적지를 광고하는 라우터로 전달되므로, 해당 이동 장치를 목적지로 하는 모든 데이터그램은 방문 네트워크로 전달
   - 만약, 이동 장치가 어떤 방문 네트워크를 떠나 다른 방문 네트워크로 진입한다면, 새로운 방문 네트워크는 그 이동 장치에 대한 새롭고 매우 구체적인 경로를 광고할 수 있으며, 이전의 방문 네트워크는 해당 이동 장치에 대한 라우팅 정보를 철회할 수 있음
   - 이는 두 가지 문제를 해결 할 수 있음
     + 다른 네트워크들은 이동 장치의 위치를 알고 있으며, 포워딩 테이블들이 데이터그램을 방문 네트워크로 안내하기 때문에 데이터그램을 그 이동 장치로 쉽게 라우팅 가능
     + 그러나 치명적인 단점으로는 '확장성'으로, 네트워크 라우터는 잠재적으로 수십억 개의 이동 장치에 대한 포워딩 테이블 항목을 유지 관리해야 하고, 다른 네트워크로 로밍할 때마다 장치 관련 항목을 갱신해야 함

3. 대안 : 이동성 관리 기능을 네트워크 코어에서 네트워크 가장자리로 밀어내어 옮기는 것
   - 이동 장치의 홈 네트를 통하는 것으로, 이동 장치의 홈 네트워크에 있는 이동성 관리 개체인 MME는 이동 장치가 위치한 방문 네트워크 추적 가능
   - 이동 장치가 위치한 네트워크를 갱신하기 위해서는 방문 네트워크와 홈 네트워크 사이에서 동작하는 프로토콜이 필요

4. 방문 네트워크 요소
   - 이동 장치는 방문 네트워크의 IP 주소가 필요 (여기에는 이동 장치의 홈 네트워크와 연결된 영구적 IP 주소, 방문 네트워크의 주소 범위에서 새로운 주소 할당, 또는 NAT를 통한 IP 주소 제공 등 포함)
   - 직접 라우팅과 간접 라우팅의 경우, 이동 장치는 홈 네트워크의 HSS에 저장된 영구적 식별자 외에 임시 식별자, 즉 새로 할당된 IP 주소를 갖게 됨
   - NAT 주소를 사용하는 경우, 이동 장치로 향하는 데이터그램은 방문 네트워크의 NAT 게이트웨이 라우터에 도달하게 되면 NAT 변환을 거쳐 이동 장치로 전달

-----
### 이동 장치로의 간접 라우팅
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/91e7264b-1c9f-4327-b227-2c9a36f4ea57">
</div>

1. 통신자는 이동 노드가 홈 네트워크에 있는지 또는 방문 네트워크에 있는지 모르는 상태로 데이터그램 목적지 주소를 단순히 이동 노드의 영구적인 주소로 설정한 후 네트워크로 전송
2. 즉, 송신하는 통신자는 이동 장치의 현재 상태를 몰라도 되며, 이는 통신자에게 이동성에 대한 완전한 투명성 제공
3. 이 경우, 데이터그램은 먼저 이동 장치의 홈 네트워크로 전달
4. HSS는 방문 네트워크와 상호작용하여 이동 장치의 위치를 추적하고 홈 네트워크의 게이트웨이 라우터를 관리
   - 이 게이트웨이 라우터의 중요한 일 중 하나는 해당 네트워크에 집이 있지만, 현재 방문 네트워크에 위치해있는 장치를 목적지 주소로 하는 데이터그램이 도착하는지 확인하는 것
   - 홈 네트워크 게이트웨이는 이 데이터그램을 가로채서 HSS와 상의하여 이동 장치가 있는 방문 네트워크를 결정한 후, 해당 데이터그램을 방문 네트워크 게이트웨이 라우터로 전달
5. 그러면 방문 네트워크 게이트웨이 라우터는 데이터그램을 이동 장치로 전달
   - 만일 NAT 변환이 사용된다면 방문 네트워크 게이트웨이 라우터가 NAT 변환 수행
6. 홈 네트워크를 통한 재라우팅(Rerouting) 방법
   - 홈 네트워크 게이트웨이는 도착한 데이터그램을 방문 네트워크 게이트웨이 라우터에게 전달해야 함
   - 반면, 데이터를 수신하는 애플리케이션 입장에서는 데이터그램이 홈 네트워크를 통해 전달되었다는 사실을 인식하지 않는 것이 좋으므로 통신자의 데이터그램을 원래 그대로 두는 것이 좋음
   - 홈 게이트웨이가 통신자의 원래의 데이터그램을 캡슐화하여 더 큰 데이터그램에 넣음으로써 충족 가능
   - 더 큰 데이터그램은 주소가 지정된 방문 네트워크 게이트웨이 라우터에 전달되고, 이후 캡슐화를 해제하여 더 큰 데이터그램 내 원래의 데이터그램을 복원하여 이동 장치로 전달

7. 이동 장치가 통신자에게 데이터 그램을 보내는 것
   - 이동 장치는 NAT 변환을 수행하기 위해 방문 게이트웨이 라우터를 통해 데이터그램을 전달
   - 데이터그램을 홈 게이트웨이 라우터로 다시 터널링하여 다시 통신자에게 전달
   - 로컬 브레이크 아웃(Local Breakout) : 데이터그램은 방문 네트워크에서 통신자로 직접 전달
  
8. 요약
   - 이동 장치에서 방문 네트워크로의 프로토콜 : 이동 장치는 방문 네트워크와 결햅해야 하며, 마찬가지로 방문 네트워크를 떠날 때 결합을 해제해야 함
   - 방문 네트워크에서 홈 네트워크로의 HSS 등록 프로토콜 : 방문 네트워크는 홈 네트워크의 HSS에 이동 장치 위치를 등록해야하며, HSS에서 얻은 정보를 장치 인증 수행에 사용
   - 홈 네트워크 게이트웨이와 방문 네트워크 게이트웨이 라우터 사이 데이터그램 터널링 프로토콜 : 송신 측은 통신자의 원래 데이터그램을 새로운 데이터그램 내 캡슐화한 후 목적지로 전달, 수신 측은 게이트웨이 라우터에서 캡슐화 해제 및 NAT 변환을 거쳐 원래 데이터그램을 이동장치로 전달하는 작업 수행

9. 이동 장치가 한 방문 네트워크에서 다른 방문 네트워크로 로밍할 때, 새로운 방문 네트워크 정보가 홈 네트워크 HSS에 갱신될 필요가 있으며, 홈 게이트웨이와 방문 게이트웨이 라우터 사이 터널 종단점이 이동되어야 함
10. 이동 장치가 네트워크 간 이동할 때 데이터그램 흐름이 종단되는 경우 : 한 방문 네트워크에서의 연결이 끊기고 나서 다음 방문 네트워크로의 결합이 재개되는 시간 간격이 짧다면 데이터그램 손실은 거의 발생하지 않음
    - 따라서, 이동 장치가 네트워크 사이를 이동할 때, 연결 내에서 간혈적으로 데이터그램이 손실된다고 해도 치명적인 문제가 아님
    - 무손실 통신이 필요한 경우에는 상위 계층 프로토콜 메커니즘에 의해 데이터그램 손실이 복구될 것이며, 손실이 네트워크 혼잡으로 인한 것인지, 장치 이동성으로 인한 것인지 상관 없음

-----
### 이동 장치로의 직접 라우팅
-----
1. 간접 라우팅 방식은 삼각 라우팅 문제로 알려진 비효율성을 가짐
2. 즉, 이동 장치를 목적지로 하는 데이터그램은 통신자와 로밍 중인 이동 장치 사이에 훨씬 더 효율적인 경로가 있음에도, 일단 먼저 홈 네트워크로 전달된 다음 방문 네트워크로 전달되어야 함
3. 직접 라우팅은 삼각 라우팅 비효율성 문제를 해결할 수 있으나, 이를 위해서는 추가적인 복잡도 발생
<div align="center">
<img src="https://github.com/user-attachments/assets/4fb2e8e5-ad1d-411b-bc90-226e01c21b68">
</div>

  - 통신자는 먼저 이동 장치가 위치한 방문 네트워크를 발견하고, 이동 장치의 홈 네트워크 HSS에 질의함으로써 수행되고, 간접 라우팅가 마찬가지로 이동 장치의 방문 네트워크가 HSS에 등록되어 있는 것으로 가정
  - 통신자는 데이터그램을 이동 장치의 방문 네트워크로 직접 터널링해서 전달
  - 두 가지 중요 문제
    + 이동 사용자 위치 파악 프로토콜 필요 : 통신자가 HSS에게 이동 장치의 방문 네트워크 질의를 위해서임
    + 간접 라우팅에서는 홈 네트워크 HSS를 갱신하고, 터널의 종단점을 새로운 방문 네트워크의 게이트웨이 라우터로 변경할 수 있지만, 직접 라우팅의 경우 방문 네트워크가 변경되는 걍우 해결이 쉽지 않음 : 통신자는 세션이 시작될 때 HSS에게 단 한 차례만 문의하며 이후 변화된 정보를 알기 어려우므로, 이동 장치가 이동할 때마다 통신자를 미리 갱신해주려면 추가적인 프로토콜 메커니즘이 필요
