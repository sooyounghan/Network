-----
### 패킷 교환 네트워크에서 지연
-----
1. 패킷을 경로를 따라 한 노드(호스트 혹은 라우터)에서 다음 노드(호스트 호은 라우터)로 전달되므로 그 패킷은 경로상 각 노드에서 다양한 지연을 겪음
2. 중요 지연 : 노드 처리 지연(Node Processing Delay), 큐잉 지연(Queuing Delay), 전송 지연(Transmission Delay), 전파 지연(Propagation Delay) 존재
   - 이러한 지연이 쌓여서 전체 노드 지연(Total Node Delay) 발생
3. 지연 유형
<div align="center">
<img src="https://github.com/user-attachments/assets/e2aec2a7-5d32-4e88-8e20-fd0892e75394">
</div>

   - 출발지와 목적지 사이 종단 간 경로의 일부로서 한 패킷이 업 스트림 노드로부터 라우터 A를 통해 라우터 B로 보내짐
   - 라우터 A가 라우터 B에 이르는 하나의 출력(Outgoing) 링크에 가지며, 링크 앞에 큐(Queue, Buffer) 존재
   - 패킷이 업스트림 노드로부터 라우터 A에 도착하면, 라우터 A는 그 패킷에 적당한 출력 링크를 결정하기 위해 패킷 헤더를 조사하고 선택된 링크로부터 그 패킷을 보내며, 여기서는 패킷에 대한 출력 링크가 라우터 B에 이르는 링크

4. 처리 지연
   - 패킷 헤더가 조사하고 그 패킷을 어디로 보낼지 결정하는 시간
   - 처리 지연은 업스트림 노드에서 라우터 A로 패킷의 비트를 전송하면서 발생하는 패킷의 비트 레벨 오류를 조사하는 데 필요한 시간과 같은 요소를 포함할 수 있으며, 고속 라우터에서는 일반적으로 수 마이크로초
   - 이 노드 처리 후 라우터는 라우터 B에 이르는 링크에 앞선 큐를 보냄

5. 큐잉 지연
   - 패킷은 큐에서 링크를 전송되기를 기다리면서 해당 지연을 겪음
   - 특정 패킷의 큐잉 지연 길이는 큐에 저장되어 링크로 전송되기를 기다리는 앞서 도착한 패킷의 수에 의해 결정되며, 주어진 패킷의 지연은 패킷마다 상당히 다름
   - 큐가 비어 있고, 다른 패킷이 전송 중인 상태가 아니라면 이 때 패킷의 큐잉 지연은 0
   - 반면, 트래픽이 많고 다른 많은 패킷이 전송 대기 중이면 큐잉 지연은 매우 길어짐
   - 도착하는 패킷이 발견하는 이미 도착한 패킷의 수는 큐에 도착하는 트래픽의 강도와 특성에 대한 함수
   - 큐잉 지연은 수 마이크로초에서 수 밀리초에 이름

6. 전송 지연
   - 패킷이 선입 선출 방식으로 전송된다고 가정하면 인터넷에서 일반적인 것처럼 패킷은 앞서 도착한 다른 모든 패킷이 전송된 다음 전송
   - 패킷의 길이를 L비트로, 라우터 A에서 라우터 B까지의 링크의 전송률을 $R$ bps라고 하면, R은 라우터 B로 가는 링크의 전송률에 의해 결정
     + 예) 10 Mbps 이더넷 링크의 경우 전송률 R은 10 Mbps
   - 즉, 전송 지연은 L/R
   - 이는 패킷의 모든 비트를 링크로 밀어내는 데 (또는 전송하는 데) 필요한 시간으로, 일반적으로 수 마이크로초에서 수 밀리초에 해당

7. 전파 지연
   - 비트가 링크에 전해지면 라우터 B까지 전파되어야 하는데, 링크가 처음부터 라우터 B까지의 전파에 필요한 시간
   - 비트는 링크의 전파 속도로 전파되며, 전파 속도는 물리 매체(꼬임광선, 광섬유 등)에 따라 다르지만 범위는 다음과 같음 : $2 X 10^{8}$ m/s ~ $3 x 10^{8}$ m/s
     + 이는 빛의 속도와 같거나 약간 작음
   - 두 라우터 사이의 거리를 전파 속도를 나눈 것이므로, 전파 지연은 $d / s$ (d : 라우터 A와 B 사이의 거리, s는 링크의 전파 속도)
     + 패킷의 마지막 비트가 B 노드에 전파되면, 이 비트와 앞선 모든 비트는 라우터 B에 저장
   - 광역 네트워크에서 전파 지연은 일반적으로 수 밀리초에 이름

8. 💡 전송 지연과 전파 지연 비교
   - 전송 지연 : 라우터가 패킷을 보내는 데 필요한 시간 (패킷 길이와 링크 전송률의 함수이며, 두 라우터 사이의 거리와는 관계 없음)
   - 전파 지연 : 비트가 한 라우터에서 다음 라우터로 전파되는데 걸리는 시간 (두 라우터 사이의 거리에 대한 함수, 패킷 길이나 링크 전송률과 관계 없음)

9. 전체 노드 지연 계산 : $d_{total} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$ ($d_{total}$ : 전체 노드 지연, $d_{proc}$ : 처리 지연, $d_{queue}$ : 큐잉 지연, $d_{trans}$ : 전송 지연, $d_{prop}$ : 전파 지연)

-----
### 큐잉 지연과 패킷 손실
-----
1. 큐잉 지연은 다른 세 가지 지연과 다름
   - 예를 들어, 10개의 패킷이 동시에 비어 있는 큐에 도착한다면, 전송된 첫 패킷은 큐잉 지연을 겪지 않지만, 마지막으로 전송된 패킷은 상당히 많은 큐잉 지연을 겪음 (다른 9개 패킷이 전송되기를 기다림)
   - 따라서, 큐잉 지연의 특성을 묘사할 때, 평균 큐잉 지연, 큐잉 지연 분산, 큐잉 지연이 어느 특정 값을 넘을 확률 같은 통계 측정을 일반적으로 이용

2. 트래픽이 큐에 도착하는 비율, 링크 전송률, 도착하는 트래픽 특성, 즉 그 트래픽이 주기에 맞춰서 버스트(Burst)하게 도착하느냐에 의해 주로 결정
   - $a$는 패킷이 큐에 도착하는 평균율(단위 : 패킷 / 초), $R$은 전송률(즉, 비트가 큐에서 밀려나는 비율 (비트 / 초)), 편의상 모든 패킷을 $L$비트라고 가정
   - 비트가 큐에 도착하는 평균율 : $La$ 비트 / 초
   - 큐가 매우 커서 무한대 비트를 저장할 수 있다고 가정
   - 트래픽 강도(Traffic Intensity), 즉, $La / R$은 큐잉 지연의 정도를 측정하는데 매우 유용
     + $La / R > 1$이면, 비트가 큐에 도착하는 평균율이 비트가 큐에 전송되는 비율을 초과하므로, 큐는 끝없이 증가하고 큐잉 지연은 무한대에 도달하므로, 트래픽 강도가 1보다 크지 않도록 시스템을 설계해야 함
     + $La / R ≤ 1$이면, 도착 트래픽의 특성이 큐잉 지연에 영향을 미침
       * 예를 들어, 패킷이 주기적으로 도착한다면, 즉, 하나의 패킷이 $L / R$초마다 도착한다면, 모든 패킷은 빈 큐에 도착할 것이고 큐잉 지연은 없을 것
       * 반면, 패킷이 주기적이 아닌 몰려서 도착한다면, 상당한 평균 큐잉 지연 발생
       * $N$개의 패킷이 동시에 $(L / R) N$초 마다 도착한다고 가정할 때, 처음에 전송된 패킷은 큐잉 지연이 없지만, 두 번째 전송된 패킷은 $L / R$초의 지연을 가지므로, $n$번째 전송된 패킷은 $(n - 1) L / R$초의 큐잉 지연을 가짐

<div align="center">
<img src="https://github.com/user-attachments/assets/434a7569-e7fe-45ac-a6ee-53d252876770">
</div>

3. 하지만, 큐에 도착하는 프로세스는 랜덤하므로, 패킷의 도착에 전혀 고정된 패턴이 없고 임의의 시간만큼 떨어져서 도착하게 됨
4. 특히, 트래픽 강도가 0에 가까우면, 패킷 도착이 드물고 간격이 멀어서 다음에 도착하는 패킷이 큐에서 다른 패킷을 발견하는 경우가 없을 것
5. 반면에, 트래픽 강도가 1에 가까우면, 패킷 도착이 전송용량을 초과하여(패킷 도착률의 가변성) 큐가 생성될 것
6. 즉, 도착률이 전송률보다 작아질 때, 큐의 길이는 줄어들 것이며, 트래픽 강도가 1에 접근할 수록 평균 큐 길이는 점점 증가
7. 즉, 트래픽 강도가 1에 접근할수록 평균 큐잉 지연이 급격히 증가하며, 강도에 있어서 작은 비율의 증가로 지연에서 훨씬 큰 비율의 증가를 일으킴
8. 패킷 손실
   - 현실에서 큐 용량은 스위치 설계와 비용에 의존하며 일반적으로 유한적인 용량을 가지므로, 트래픽 강도가 1에 접근함에 따라 패킷 지연이 실제로 무한히 일어나지는 않음
   - 큐가 꽉차게 되므로, 패킷을 저장할 수 없으므로, 라우터는 그 패킷을 버리거나(Drop) 잃어버리게 됨(Lost)
   - 종단 시스템 입장에서 패킷 손실은 패킷이 네트워크 코어로 전송되었으나 네트워크로부터 목적지에 나타나지 않은 것으로 보이며, 손실 패킷의 비율은 트래픽 강도가 클수록 증가

-----
### 종단 간 지연
-----
1. 출발지 호스트와 목적지 호스트 사이 $N - 1$개의 라우터가 있다고 가정
   - 네트워크가 혼잡하지 않으며(큐잉 지연을 무시할 수 있음), 각 라우터와 출발지 호스트의 처리 지연은 $d_{proc}$, 각 호스트와 출발지 호스트에서의 전송률 $R 비트 / 초$, 전파 지연은 $d_{prop}$
<div align="center">
<img src="https://github.com/user-attachments/assets/ac05fafb-9c21-455a-bd9a-ae4bff6f467b">
</div>

   - $d_{trans} = L / R$이고, $L$은 패킷 크기

2. Traceroute
   - 사용자가 목적지 호스트 이름을 제시하면 출발지 호스트에 있는 프로그램은 목적지를 향해 여러 개의 특별한 패킷을 보내며, 이 패킷들은 목적지로 전진하면서 여러 개 라우터를 통과
   - 한 라우터가 특별한 패킷을 받으면, 출발지로 짧은 메세지를 보내는데, 이 메세지에는 그 라우터의 이름과 주소가 포함
   - 예를 들어, 출발지와 목적지 사이 $N - 1$개의 라우터가 있다고 가정
     + 출발지가 네트워크로 $N$개의 특별 패킷을 보내는데 각 최종 목적지 주소를 가지고 있으며, $N$개의 특별 패킷은 1부터 N까지 표시
     + $n$번째 라우터가 $n$으로 표시된 $n$번째 패킷을 받으면 라우터는 그 패킷을 목적지까지 전달하지 않고 대신 출발지에 역으로 메세지를 전송
     + 그리고 목적지 호스트가 $N$번째 패킷을 받으면 그 목적지 노드는 그 패킷을 파기하고 출발지로 메세지를 보냄
     + 출발지는 한 패킷을 보내고, 그에 해당하는 응답 메세지를 받을 때까지 경과 시간을 기록
     + 또한, 메세지를 보내온 라우터(혹은 목적지 호스트) 이름과 주소도 기록
   - 이러한 과정을 세 번 반복하므로, 출발지는 실제로 $3 X N$ 패킷을 목적지로 보냄
<div align="center">
<img src="https://github.com/user-attachments/assets/d0254760-30d4-4fd0-b86e-57be323edc0c">
</div>

   - 첫 항목은 앞에서 기술한 n값, 즉 라우터 번호 / 두 번쨰 항목은 라우터의 이름 / 세 번째 항목은 xxx.xxx.xxx.xxx 형태의 라우터 주소
   - 마지막 3개 항목은 세 번 실험의 왕복 지연 시간으로, 출발지가 네트워크에서 패킷 손실로 인해 어떤 주어진 라우터로부터 3개보다 적은 메세지를 받으면 라우터 번호 뒤에 별표로 표시하여 그 라우터에 대해서는 왕복 시간이 세 번보다 적음을 알림

3. 큐잉 지연은 시간에 따라 변하므로, $n$번 라우터에 보내진 패킷 $n$의 왕복 지연은 $n + 1$번 라우터로 보내진 패킷 $n + 1$의 왕복 지연보다 길 수 있음

4. 그 밖의 지연
   - 패킷을 전송하고자 하는 종단 시스템은 다른 종단 시스템과 매체를 공유하기 위해 프로토콜의 일부로 전송을 의도적 지연 시킬 수 있음
   - VoIP (Voice-over-IP) 애플리케이션에는 미디어 패킷화 지연(Media Packetization Delay)가 존재하는데, 송신 측에서 먼저 패킷을 보내기 전 패킷을 인코딩된 디지털 음성으로 채워야 하는데, 이 채우는 시간이 심각할 수 있음

-----
### 컴퓨터 네트워크에서의 처리율
-----
1. 지연과 패킷 손실 이외에 컴퓨터 네트워크에서 또 다른 주요한 성능 수단은 종단 간 처리율(Throughput)
2. 컴퓨터 네트워크를 통해 호스트 A에서 호스트 B로 커다란 파일을 전송하는 것을 고려
   - 어느 한 순간에서의 순간적인 처리율(Instantaneous Throughtput)은 호스트가 B가 파일을 수신하는 비율(비트 / 초)
   - 만약 파일이 F비트로 구성되고 호스트 B가 모든 F비트를 수신하는 데 T초가 걸린다고 한다면, 이 때 파일 전송의 평균 처리율(Average Throughput)은 F / T 비트 / 초
   - 파일 전송을 포함하는 애플리케이션의 경우, 지연은 심각하지 않지만 가능한 높은 처리율을 갖는 것이 바람직
<div align="center">
<img src="https://github.com/user-attachments/assets/be38fc53-e5eb-47d3-9a96-b798bca30fda">
</div>

3. 2개의 종단 시스템, 즉 2개의 통신 링크와 라우터로 연결된 하나의 서버와 하나의 클라이언트
   - $R_{s}$는 서버와 라우터 간의 링크 속도, $R_{c}$는 라우터와 클라이언트 간의 링크 속도
   - 전체 네트워크로 보내지는 비트는 서버에서 클라이언트로만 보내지는 비트라고 가정
   - 서버는 $R_{s}$ bps보다 빠른 속도로 링크 상으로 비트를 보낼 수 없고, 라우터는 $R_{c}$ bps보다 빠른 속도로 비트를 전달할 수 없음
   - 만약, $R_{s}$ < $R_{c}$ 이면, 서버가 배출한 비트는 라우터를 통해 올바르게 전달되지만, $R_{s}$ > $R_{c}$이면, 라우터는 자신이 수신하는 비트만큼 빠르게 전송 불가하며, 이 경우 비트들은 라우터에서 $R_{c}$의 속도로 떠나게 되고, 종단 간 처리율은 $R_{c}$가 될 것
   - 따라서, 2개의 링크로 구성된 네트워크의 경우 처리율은 min{$R_{s}$, $R_{c}$}, 즉 병목 링크(Bottlenck Link)의 전송률이 처리율이 됨
   - 따라서, F비트의 커다란 파일을 서버에서 클라이언트로 전송하는데 걸리는 시간 : F / min{$R_{s}$, $R_{c}$}의 근사값
     + F = 3,200만 비트 / $R_{s}$ = 2 Mbps / $R_{c}$ = 1 Mbps의 접속 링크를 가지면, 파일을 전송하는데 걸리는 시간은 32초
     + 이는 패킷 수준과 프로토콜 문제를 고려하지 않은 단지 근삿값

4. 서버와 클라이언트 간 N개의 링크를 가진 네트워크
   - 여기서 N개 링크의 전송률은 각각, $R_{1}, R_{2}, ... , R_{N}$
   - 따라서, 서버로부터 클라이언트로 파일을 전송하는 경우 처리율 : min{$R_{1}, R_{2}, ... , R_{N}$} (서버와 클라이언트 간 경로 상 병목 링크 전송률)

<div align="center">
<img src="https://github.com/user-attachments/assets/d402d7ba-7471-4330-b8f4-3aa92bcf6229">
</div>

5. 컴퓨터 네트워크로 연결된 2개의 종단 시스템, 즉, 서버와 클라이언트
   - 서버는 $R_{s}$의 접속 링크 속도로 네트워크 연결, $R_{c}$의 접속 링크 속도로 네트워크 연결
   - 통신 네트워크의 코어에 있는 모든 링크가 $R_{s}$와 $R_{c}$보다 매우 높은 전송률 갖고 있다고 가정
   - 출발지에서 목적지로 흐를 수 있는 비트 속도는, 처리율 = min{$R_{s}$, $R_{c}$}로, 오늘날의 인터넷에서의 처리율에 대한 제한 요소는 전형적으로 접속 네트워크

6. 컴퓨터 네트워크 코어에 연결된 10개의 서버와 10개의 클라이언트로 구성
   - 10개의 동시적인 다운로드 발생 (10개의 클라이언트-서버 쌍을 포함)되며, 10개의 다운로드가 유일한 트래픽
   - 10개의 다운로드를 통과하는 코어에 하나의 링크 존재하며, 링크 R의 전송률을 R이라고 가정
   - 모든 서버 접속 링크가 같은 $R_{s}$의 속도를 가지며, 모든 클라이언트 접속 링크는 같은 $R_{c}$의 속도를 가짐
   - 코어에서의 모든 링크의 전송률(속도 R인 하나의 공통 링크는 예외)은 $R_{s}$, $R_{c}$, $R$보다 크다고 가정
   - 공통 링크 R의 속도가 크다면($R_{s}$와 $R_{c}$보다 수백 배 큼), 다운로드에 대한 처리율은 min{$R_{s}$, $R_{c}$}
   - 하지만, 공통 링크 속도가 같은 수준일 때의 예시
     + $R_{s}$ = 2 Mbps, $R_{c}$ = 1 Mbps, $R$ = 5 Mbps로, 공통 링크는 10개의 다운로드에 똑같이 전송률을 나눈다고 가정
     + 코어에서의 공유 링크가 병목이 되며, 이 공유 링크는 각 다운 로드에 500 kbps의 처리율을 제공하므로, 각 다운로드에 대한 종단 간 처리율은 500 kbps로 줄어듬

7. 이처럼, 처리율이 데이터가 흐르는 링크의 전송률에 의존함
   - 다른 간섭 트래픽이 없는 경우, 처리율은 출발지와 목적지 간 경로상에서 최소 전송률로 근사화가 가능
   - 하지만 간섭 트래픽에도 의존하며, 특히, 많은 데이터 흐름이 높은 전송률을 가진 링크를 통해 지나간다면, 파일 전송의 경우 그 링크가 병목 링크가 될 수 있음
