-----
### 패킷 교환 네트워크에서 지연
-----
1. 패킷을 경로를 따라 한 노드(호스트 혹은 라우터)에서 다음 노드(호스트 호은 라우터)로 전달되므로 그 패킷은 경로상 각 노드에서 다양한 지연을 겪음
2. 중요 지연 : 노드 처리 지연(Node Processing Delay), 큐잉 지연(Queuing Delay), 전송 지연(Transmission Delay), 전파 지연(Propagation Delay) 존재
   - 이러한 지연이 쌓여서 전체 노드 지연(Total Node Delay) 발생
3. 지연 유형
<div align="center">
<img src="https://github.com/user-attachments/assets/e2aec2a7-5d32-4e88-8e20-fd0892e75394">
</div>

   - 출발지와 목적지 사이 종단 간 경로의 일부로서 한 패킷이 업 스트림 노드로부터 라우터 A를 통해 라우터 B로 보내짐
   - 라우터 A가 라우터 B에 이르는 하나의 출력(Outgoing) 링크에 가지며, 링크 앞에 큐(Queue, Buffer) 존재
   - 패킷이 업스트림 노드로부터 라우터 A에 도착하면, 라우터 A는 그 패킷에 적당한 출력 링크를 결정하기 위해 패킷 헤더를 조사하고 선택된 링크로부터 그 패킷을 보내며, 여기서는 패킷에 대한 출력 링크가 라우터 B에 이르는 링크

4. 처리 지연
   - 패킷 헤더가 조사하고 그 패킷을 어디로 보낼지 결정하는 시간
   - 처리 지연은 업스트림 노드에서 라우터 A로 패킷의 비트를 전송하면서 발생하는 패킷의 비트 레벨 오류를 조사하는 데 필요한 시간과 같은 요소를 포함할 수 있으며, 고속 라우터에서는 일반적으로 수 마이크로초
   - 이 노드 처리 후 라우터는 라우터 B에 이르는 링크에 앞선 큐를 보냄

5. 큐잉 지연
   - 패킷은 큐에서 링크를 전송되기를 기다리면서 해당 지연을 겪음
   - 특정 패킷의 큐잉 지연 길이는 큐에 저장되어 링크로 전송되기를 기다리는 앞서 도착한 패킷의 수에 의해 결정되며, 주어진 패킷의 지연은 패킷마다 상당히 다름
   - 큐가 비어 있고, 다른 패킷이 전송 중인 상태가 아니라면 이 때 패킷의 큐잉 지연은 0
   - 반면, 트래픽이 많고 다른 많은 패킷이 전송 대기 중이면 큐잉 지연은 매우 길어짐
   - 도착하는 패킷이 발견하는 이미 도착한 패킷의 수는 큐에 도착하는 트래픽의 강도와 특성에 대한 함수
   - 큐잉 지연은 수 마이크로초에서 수 밀리초에 이름

6. 전송 지연
   - 패킷이 선입 선출 방식으로 전송된다고 가정하면 인터넷에서 일반적인 것처럼 패킷은 앞서 도착한 다른 모든 패킷이 전송된 다음 전송
   - 패킷의 길이를 L비트로, 라우터 A에서 라우터 B까지의 링크의 전송률을 $R$ bps라고 하면, R은 라우터 B로 가는 링크의 전송률에 의해 결정
     + 예) 10 Mbps 이더넷 링크의 경우 전송률 R은 10 Mbps
   - 즉, 전송 지연은 L/R
   - 이는 패킷의 모든 비트를 링크로 밀어내는 데 (또는 전송하는 데) 필요한 시간으로, 일반적으로 수 마이크로초에서 수 밀리초에 해당

7. 전파 지연
   - 비트가 링크에 전해지면 라우터 B까지 전파되어야 하는데, 링크가 처음부터 라우터 B까지의 전파에 필요한 시간
   - 비트는 링크의 전파 속도로 전파되며, 전파 속도는 물리 매체(꼬임광선, 광섬유 등)에 따라 다르지만 범위는 다음과 같음 : $2 X 10^{8}$ m/s ~ $3 x 10^{8}$ m/s
     + 이는 빛의 속도와 같거나 약간 작음
   - 두 라우터 사이의 거리를 전파 속도를 나눈 것이므로, 전파 지연은 $d / s$ (d : 라우터 A와 B 사이의 거리, s는 링크의 전파 속도)
     + 패킷의 마지막 비트가 B 노드에 전파되면, 이 비트와 앞선 모든 비트는 라우터 B에 저장
   - 광역 네트워크에서 전파 지연은 일반적으로 수 밀리초에 이름

8. 💡 전송 지연과 전파 지연 비교
   - 전송 지연 : 라우터가 패킷을 보내는 데 필요한 시간 (패킷 길이와 링크 전송률의 함수이며, 두 라우터 사이의 거리와는 관계 없음)
   - 전파 지연 : 비트가 한 라우터에서 다음 라우터로 전파되는데 걸리는 시간 (두 라우터 사이의 거리에 대한 함수, 패킷 길이나 링크 전송률과 관계 없음)

9. 전체 노드 지연 계산 : $d_{total} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$ ($d_{total}$ : 전체 노드 지연, $d_{proc}$ : 처리 지연, $d_{queue}$ : 큐잉 지연, $d_{trans}$ : 전송 지연, $d_{prop}$ : 전파 지연)

-----
### 큐잉 지연과 패킷 손실
-----
1. 큐잉 지연은 다른 세 가지 지연과 다름
   - 예를 들어, 10개의 패킷이 동시에 비어 있는 큐에 도착한다면, 전송된 첫 패킷은 큐잉 지연을 겪지 않지만, 마지막으로 전송된 패킷은 상당히 많은 큐잉 지연을 겪음 (다른 9개 패킷이 전송되기를 기다림)
   - 따라서, 큐잉 지연의 특성을 묘사할 때, 평균 큐잉 지연, 큐잉 지연 분산, 큐잉 지연이 어느 특정 값을 넘을 확률 같은 통계 측정을 일반적으로 이용

2. 트래픽이 큐에 도착하는 비율, 링크 전송률, 도착하는 트래픽 특성, 즉 그 트래픽이 주기에 맞춰서 버스트(Burst)하게 도착하느냐에 의해 주로 결정
   - $a$는 패킷이 큐에 도착하는 평균율(단위 : 패킷 / 초), $R$은 전송률(즉, 비트가 큐에서 밀려나는 비율 (비트 / 초)), 편의상 모든 패킷을 $L$비트라고 가정
   - 비트가 큐에 도착하는 평균율 : $La$ 비트 / 초
   - 큐가 매우 커서 무한대 비트를 저장할 수 있다고 가정
   - 트래픽 강도(Traffic Intensity), 즉, $La / R$은 큐잉 지연의 정도를 측정하는데 매우 유용
     + $La / R > 1$이면, 비트가 큐에 도착하는 평균율이 비트가 큐에 전송되는 비율을 초과하므로, 큐는 끝없이 증가하고 큐잉 지연은 무한대에 도달하므로, 트래픽 강도가 1보다 크지 않도록 시스템을 설계해야 함
     + $La / R ≤ 1$이면, 도착 트래픽의 특성이 큐잉 지연에 영행을 미침
       * 예를 들어, 패킷이 주기적으로 도착한다면, 즉, 하나의 패킷이 $L / R$초마다 도착한다면, 모든 패킷은 빈 큐에 도착할 것이고 큐잉 지연은 없을 것
       * 반면, 패킷이 주기적이 아닌 몰려서 도착한다면, 상당한 평균 큐잉 지연 발생
       * $N$개의 패킷이 동시에 $(L / R) N$초 마다 도착한다고 가정할 때, 처음에 전송된 패킷은 큐잉 지연이 없지만, 두 번째 전송된 패킷은 $L / R$초의 지연을 가지므로, $n$번째 전송된 패킷은 $(n - 1) L / R$초의 큐잉 지연을 가짐

<div align="center">
<img src="https://github.com/user-attachments/assets/434a7569-e7fe-45ac-a6ee-53d252876770">
</div>

3. 하지만, 큐에 도착하는 프로세스는 랜덤하므로, 패킷의 도착에 전혀 고정된 패턴이 없고 임의의 시간만큼 떨어져서 도착하게 됨
4. 특히, 트래픽 강도가 0에 가까우면, 패킷 도착이 드물고 간격이 멀어서 다음에 도착하는 패킷이 큐에서 다른 패킷을 발견하는 경우가 없을 것
5. 반면에, 트래픽 강도가 1에 가까우면, 패킷 도착이 전송용량을 초과하여(패킷 도착률의 가변성) 큐가 생성될 것
6. 즉, 도착률이 전송률보다 작아질 때, 큐의 길이는 줄어들 것이며, 트래픽 강도가 1에 접근할 수록 평균 큐 길이는 점점 증가
7. 즉, 트래픽 강도가 1에 접근할수록 평균 큐잉 지연이 급격히 증가하며, 강도에 있어서 작은 비율의 증가로 지연에서 훨씬 큰 비율의 증가를 일으킴
8. 패킷 손실
   - 현실에서 큐 용량은 스위치 설계와 비용에 의존하며 일반적으로 유한적인 용량을 가지므로, 트래픽 강도가 1에 접근함에 따라 패킷 지연이 실제로 무한히 일어나지는 않음
   - 큐가 꽉차게 되므로, 패킷을 저장할 수 없으므로, 라우터는 그 패킷을 버리거나(Drop) 잃어버리게 됨(Lost)
   - 종단 시스템 입장에서 패킷 손실은 패킷이 네트워크 코어로 전송되었으나 네트워크로부터 목적지에 나타나지 않은 것으로 보이며, 손실 패킷의 비율은 트래픽 강도가 클수록 증가
