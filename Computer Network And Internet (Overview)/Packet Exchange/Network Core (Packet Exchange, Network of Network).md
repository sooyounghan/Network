-----
### 패킷 교환
-----
1. 네트워크 애플리케이션에서 종단 시스템들은 서로 메세지(Message)를 교환
2. 출발지 종단 시스템에서 목적지 종단 시스템으로 메세지를 보내기 위해 송신 시스템은 긴 메세지를 패킷(Packet)이라고 하는 작은 데이터 덩어리로 분할
3. 송신 측과 수신 측 사이에서 각 패킷은 통신 링크와 패킷 스위치(Packet Switch)(라우터(Router)와 링크 계층 스위치(Link-Layer Switch)의 두 가지 유형)를 거치게 됨
4. 패킷은 링크의 최대 전송률과 같은 속도로 각 통신 링크에서 전송
<div align="center">
<img src="https://github.com/user-attachments/assets/09e53c4d-f179-47f2-806f-1fcd01fe3eba">
</div>

5. 따라서, 출발지 종단 시스템 혹은 패킷 스위치가 ${\left(\frac{R bit}{초} \right)}$ 속도로 링크에서 L비트의 패킷을 송신한다면, 그 패킷을 전송하는데 걸리는 시간은 ${\left(\frac{L}{R} \right)}$초

-----
### 저장 후 전달
-----
1. 대부분의 패킷 스위치는 저장-후-전달 전송(Store-And-Forward Transmission) 방식을 이용
2. 스위치가 출력 링크로 패킷의 첫 비트를 전송하기 전에 전체 패킷을 받아야 함
<div align="center">
<img src="https://github.com/user-attachments/assets/d5329788-d3c3-4c38-942e-855ce5c99606">
</div>

3. 하나의 라우터가 연결되고 2개의 종단 시스템으로 구성된 간단한 네트워크
   - 라우터는 보통 여러 개의 링크를 갖는데, 라우터의 기능이 입력되는 패킷을 출력되는 링크로 교환하는 역할
   - 여기서는 라우터는 한 (입력) 링크에서 유일한 다른 접속 링크로 패킷을 전달하는 매우 간단한 기능
   - 이 예에서 출발지는 목적지로 전송할 3개의 패킷을 가지고 있으며, 각 L비트로 구성
   - 패킷 1의 일부분을 전송했고, 패킷 1의 앞쪽이 이미 라우터에 도착했으나, 저장-후-전달을 채택하므로 라우터는 수신한 비트를 전송할 수 없으며, 대신 그 패킷의 비트를 먼저 저장(Buffer, 즉 Store)한 후, 라우터가 패킷의 모든 비트를 수신한 후에만 출력 링크로 그 패킷을 전송(Transmit, 즉 Forward) 시작
   - 출발지에서 패킷을 송신하기 시작해서 전체 패킷을 목적지에서 수신할 때까지의 경과 시간 (이 때, 전파 지연(Propagation Delay, 비트가 빛의 속도로 가까운 속도로 통신선을 거쳐가는 시간은 무시)
     + 출발지는 시각 0에 전송되기 시작하여, L/R초에 출발지는 전체 패킷을 전송했고, 전체 패킷이 라우터에 수신되고 저장 (전파 지연 없음)
     + L/R초에 라우터가 전체 패킷을 수신했으므로, 라우터는 목적지를 향해 그 패킷을 출력 링크로 전송하기 시작
     + 2L/R 시각에 라우터는 전체 패킷을 전송했고, 수신 시스템이 전체 패킷을 수신했으므로, 전체 지연 시간은 2L/R
     + 만약, 스위치게 비트가 도착하자마자 (즉, 전체 패킷을 수신할 때까지 기다리지 않고) 전달한다면, 비트가 라우터에서 지연되지 않으므로 전체 지연 시간은 L/R

  - 이제 출발지가 첫 번째 패킷을 송신하기 시작한 순간부터 목적지 노드가 3개의 모든 패킷을 수신할 때까지 경과된 전체 시간 계산
    + L/R 시각 : 라우터는 첫 번쨰 패킷을 전송 시작
    + L/R 시각에 출발지도 첫 번째 패킷 모두를 송신했으므로 두 번째 패킷 송신 시작
    + 따라서, 2L/R 시각에 목적지 노드는 첫 번째 노드를 수신하게 되며, 라우터는 두 번째 패킷을 수신
    + 3L/R 시각에 목적지 노드는 처음 2개의 패킷 노드를 수신하고, 라우터는 세 번째 패킷을 수신
    + 4L/R 시각에 목적지는 3개의 모든 패킷을 수신

   - 즉, 출발지로부터 목적지 노드까지 N개의 링크로 구성되고, 각 전송률이 R인 경로를 통해 하나의 패킷을 전송할 경우 (따라서, 출발지와 목적지 사이에는 N - 1개의 라우터 존재) : $d_{종단 간 지연} = {N \left(\frac{L}{R} \right)}$

-----
### 큐잉 지연과 패킷 손실
-----
1. 각 패킷 스위치는 접속된 여러 개의 링크를 가지고 있으며, 각 링크에 대해 패킷 스위치는 출력 버퍼(Output Buffer, 출럭 큐(Output Queue))를 가지고 있으며, 그 링크로 송신하려고 하는 패킷 저장
   - 도착하는 패킷이 한 링크로 전송되어야 하는데, 그 링크가 다른 패킷을 전송하고 있으면 도착하는 패킷은 출력 버퍼에서 대기해야 함
   - 따라서, 저장-후-전달 지연 뿐 아니라, 패킷은 출력 버퍼에서 큐잉 지연(Queuing Delay)을 겪게 됨
   - 이 지연은 갑녀적이고 네트워크 혼잡 정도에 따르며, 버퍼 공간의 크기가 유한하므로 도착하는 패킷은 버퍼가 전송을 위해 대기 중인 다른 패킷들로 꽉 차는 경우가 존재하는데 이럴 경우 패킷 손실(Packet Loss)이 발생 (도착하는 패킷 혹은 이미 큐에 대기 중인 패킷을 폐기(Drop))

<div align="center">
<img src="https://github.com/user-attachments/assets/8531a3f7-96c5-426a-82fd-f53dafd74a7a">
</div>

2. 패킷 교환 네트워크 (조각의 너비는 패킷의 비트 수이며, 모든 패킷은 같은 너비와 같은 길이를 가짐)
   - 호스트 A와 B가 호스트 E로 패킷을 전송한다고 가정
   - 호스트 A와 B는 먼저 첫 번째 라우터로 100 Mbps 이더넷 링크를 통해 패킷을 전송하며, 라우터는 다음에 이들 패킷을 15 Mbps의 링크로 전달
   - 짧은 기간 동안 라우터에 도착하는 패킷의 전송률이 (bps로 변환 시) 15 Mbps를 초과하면 라우터에서 혼잡이 발생하게 되며, 링크로 전송되기 전, 링크의 출력 버퍼에 큐잉
   - 예를 들어, 호스트 A와 B가 각 동시에 연속해서 5개의 패킷을 송신하면 이들 패킷의 대부분은 큐에서 대기하는 데 시간을 보낼 것

-----
### 포워딩 테이블과 라우팅 프로토콜
-----
1. 인터넷에서 모든 종단 시스템은 IP 주소라고 하는 주소를 가지며, 출발지 종단 시스템이 패킷을 목적지 종단 시스템을 보내고자 할 대, 출발지는 패킷의 헤더에 목적지의 IP 주소를 포함
2. 이 주소는 계층적 주소를 가지며, 패킷이 네트워크의 한 라우터에 도착하면 라우터는 패킷의 목적지 주소 일부를 조사하고, 그 패킷을 이웃 라우터에 전달 (즉, 각 라우터는 목적지 주소(혹은 목적지 주소 일부)를 라우터 출력 링크로 매핑하는 포워딩 테이블(Forwarding Table)을 가지고 있음)
   - 패킷이 라우터에 도착하면 라우터는 올바른 출력 링크를 찾기 위해 주소를 조사하고 이 목적지 주소를 이용하여 포워딩 테이블을 검색한 후 라우터는 그 패킷을 출력 링크에 보냄
3. 인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 특별한 라우팅 프로토콜(Routing Protocol)을 갖고 있음
   - 예를 들어, 라우팅 프로토콜은 각 라우터로부터 각 목적지까지의 최단 경로를 결정하고 라우터에 포워딩 테이블을 설정하는 데 이 최단 경로 결과를 이용

-----
### 회선 교환
-----
1. 링크와 스위치를 네트워크를 통해 이동시키는 방식 : 회선 교환(Circuit Switching)과 패킷 교환(Packet Switching)
2. 회선 교환 네트워크에서 종단 시스템 간 통신을 제공하기 위해 경로 상 필요한 자원(버퍼, 링크 전송률)은 통신 세션(Session) 동안 확보 또는 예약(Reservation)
   - 패킷 교환 네트워크에서는 이러한 자원을 예약하지 않음
   - 세션 메세지는 On-Demand 방식으로 자원을 요청하여 사용하고 그 결과, 통신 링크에 대한 접속을 위해 기다릴 수 있음

3. 회선 교환 네트워크의 예로는 전통적인 전화망 존재
   - 송신자가 정보를 보내기 전 네트워크는 송신자와 수신자 간의 연결을 설정해야 함 : 이 연결을 회선(Circuit)이라 함
   - 네트워크가 회선을 설정할 때, 그 연결이 이루어지는 동안 네트워크 링크(각 링크의 전송 용량의 일부를 나타냄)에 일정한 전송률을 예약
   - 주어진 전송률이 송신자-수신자 연결을 위해 예약되므로, 송신자는 수신자에게 보장된(Guaranteed) 일정 전송률로 데이터 전송 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/0b72d1d5-9cbb-47c5-bb1d-ebc4efb1baef">
</div>

4. 위 네트워크는 4개의 회선 스위치가 4개의 링크에 연결되어 있음
   - 각 링크는 4개의 회선을 가지므로 각 링크는 4개의 동시에 연결 지원 가능
   - 두 호스트가 통신하고 싶을 때, 네트워크는 두 호스트 사이에 지정된 종단 간 연결(End-to-End Connection) 설정
   - 호스트 A가 호스트 B와 통신하기 위해 네트워크는 먼저 2개의 링크 각각에 한 회선을 예약하며, 각 링크는 4개의 회선을 가지므로 종단 간 연결을 사용하는 각 링크에 대해 그 연결은 연결이 지속되는 동안 링크 전체 용량의 1/4를 얻음
   - 한 호스트가 인터넷과 같은 패킷 교환 네트워크를 통해 다른 호스트로 패킷을 보내고자할 때, 회선 교환과 마찬가지로 패킷은 일련의 통신 링크를 통해 전송되지만, 회선 교환과 달리 패킷은 링크 자원을 예약하지 않고 네트워크로 보냄
   - 즉, 인터넷은 최대한 빠르게 패킷을 전달하려고 하지만, 일정 시간 내 전달을 보장하지 않음

-----
### 회선 교환 네트워크에서의 다중화
-----
1. 링크 내 한 회선은 주파수 분할 다중화(FDM, Frequency-Division Multiplexing) 혹은 시분할 다중화(TDM, Time-Division Multiplexing)로 구현
2. FDM에서 링크를 통해 설정된 연결은 그 링크의 주파수 스펙트럼 공유하며, 그 링크는 연결되는 동안 각 연결에 대한 주파수 대역을 고정 제공 (= 대역폭(Bandwidth))
3. TDM 링크의 경우 시간을 일정 주기의 프레임으로 구분하고, 각 프레임은 고정된 수의 시간 슬롯으로 나뉘며, 네트워크가 링크를 통해 하나의 연결을 설정할 때, 네트워크는 모든 프레임에서 시간 슬롯 1개를 그 연결에 할당
   - 이들 슬롯은 그 연결을 위해 사용되도록 할당되고, 그 연결의 데이터를 전송하기 위해 모든 프레임에 하나의 시간 슬롯을 갖게 됨
<div align="center">
<img src="https://github.com/user-attachments/assets/a2212d86-10e7-42fa-8e41-0d7cf2f9b41c">
</div>

4. 4개 회선을 지원하는 특정 네트워크에 대한 FDM, TDM
   - FDM의 경우 주파수 영역이 4개의 대역으로 분할 각 4kHz 대역폭을 가짐
   - TDM의 경우 시간 영역이 시간 프레임으로 분할되고 각 프레임은 4개의 시간 슬롯을 가짐
     + TDM 회선을 전송률 : 한 슬롯 안의 비트 수 * 프레임 전송률을 곱한 것 (예) 링크가 초당 8,000 프레임 전송 / 각 슬롯이 8비트로 구성 : 64kbps)
   - 회선 교환 네트워크를 통해 호스트 A에서 B까지 640,000 비트의 파일을 보내는데 거릴는 시간
     + 네트워크의 모든 링크는 24개의 슬롯을 가진 TDM를 사용하고, 1.536 Mbps 전송률이 가능하다고 가정하며, 호스트 A가 파일을 전송하기 전 종단 간 회선을 설정하는데 0.5초 소요
     + 각 회선의 전송률 : (1.536 Mpbs) / 24 = 64 kbps
     + 파일을 전송하는데 걸리는 시간 : 640,000 bit / 64kbps = 10초에 회선 설정 시간 0.5초 추가 : 10.5초
     + 이 때, 전송 시간은 링크 수와 무관, 즉, 전송 시간이나 종단 간 회선이 하나 혹은 100개의 링크를 지나더라도 동일하게 10초
     
-----
### 네트워크의 네트워크 (Network Of Network)
-----
1. 종단 시스템이 접속 ISP를 통해 인터넷에 연결되며, 다양한 접속 기술을(DSL, 케이블, FTTH 등) 이용하여 유선 혹은 무선 연결 제공하는데, 수십 개의 종단 시스템을 연결되기 위해 탄생한 용어

2. 가장 간단한 방법 - 각 접속 ISP를 직접 서로 다른 ISP와 연결하는 것으로, 그물망 설계이므로 접속 ISP에게 너무 많은 비용을 발생 (개별적인 통신 링크를 유지해야 하기 때문임)

3. 네트워크 구조 1 : 모든 접속 ISP를 하나의 글로벌 통과(Transit) ISP와 연결
   - 하지만, 매우 많은 비용이 들며, 접속 ISP가 글로벌 ISP와 교환하는 트래픽의 양을 반영하여 비용 발생
   - 접속 ISP가 글로벌 ISP에게 비용을 지불하므로 접속 ISP가 고객, 글로벌 ISP가 제공자

4. 네트워크 구조 2 : 수십만개의 접속 ISP와 다중의 글로벌 ISP로 구성
   - 하지만 글로벌 ISP는 서로 연결해야만 하며, 하나의 글로벌 ISP와 연결된 접속 ISP는 다른 글로벌 통과 서비스 제공자에 연결된 접속 ISP와 통신할 수 없음
   - 즉, 상위층에 글로벌 통과 서비스 제공자가 있고, 하위층에 접속 ISP가 있는 형태의 2계층 구조로, 글로벌 ISP가 모든 접속 ISP에 가깝게 도달할 수 있을 뿐 아니라 경제적으로 바람직하다고 가정
   - 전 세계 모든 도시에 존재하는 ISP는 없으므로, 어느 주어진 지역에서 그 지역에 있는 접속 ISP들이 연결하는 지역(Regional) ISP 존재 : 1계층(Tier-1) ISP들과 연결

5. 네트워크 구조 3 : 어떤 지역에서는 작은 지역 ISP들이 연결하는 좀 더 큰 지역 ISP들이 있을 수 있는데, 좀 더 큰 지역 ISP는 1계층 ISP에 연결되며, 최종적으로 국가 ISP에 연결되고, 최종적으로 1계층 ISP에 연결되는 다중계층구조 (오늘날의 인터넷과 대략적으로 유사)

6. 네트워크 구조 4 : 오늘날 인터넷과 유사하게 구축하기 위해서는 PoP(Points of Presence), 멀티홈(Multi-Homing), 피어링(Peering), IXP(Internet Exchange Point)를 계층적인 네트워크 구조 3에 포함해야 함
   - PoP는 최하위(접속 ISP) 계층을 제외하고 계층 구조의 모든 계층에 존재하며, 단지 제공자의 네트워크 내 있는(같은 위치에 존재하는) 하나 혹은 그 이상의 라우터 그룹이며, 고객 ISP가 제공자 ISP에 연결될 수 있음
     + 고객 네트워크가 제공자의 PoP에 연결되기 위해, 고객은 자신의 라우터 중 하나를 PoP에 있는 라우터에 직접 연결하도록 고속 링크를 제3자(Third-Party) 통신 서비스 제공자로부터 임대 가능
   - 또한, 고객 ISP가 서비스 제공 ISP에게 지불하는 요금을 줄이기 위해, 인터넷 계층 구조의 같은 계층에 있는 가까운 ISP들은 피어링 가능 : 이들 간 송수신되는 모든 트래픽을 상위 계층 ISP을 통하지 않고 직접 송수신할 수 있도록 자신들의 네트워크를 직접 연결하는 방법 (요금을 서로 지불하지 않음)
   - IXP(일반적으로 교환기를 갖춘 것)를 구축도 가능하며, 다중 ISP 들이 서로 피어링 할 수 있는 것
   - 이러한 생태계를 네트워크 구조 4

7. 네트워크 구조 5 : 2012년 인터넷 기술
   - 네트워크 구조 4 위에 콘텐츠 제공자 네트워크(Content-Provider Network)를 추가하여 구축
<div align="center">
<img src="https://github.com/user-attachments/assets/6ac4b6fc-1587-4d7f-a2b3-f38f430c1410">
</div>

8. 정리
   - 오늘날 인터넷(네트워크의 네트워크)은 복잡하며 12개 정도의 1계층 ISP들과 수십만개의 하위 게층 ISP로 구성
   - 하위 계층 ISP들은 상위 게층 ISP들과 연결하고, 상위 계층 ISP들은 서로 연결
   - 사용자와 컨텐츠 제공자는 하위 계층 ISP들의 고객이고, 하위 계층 ISP들은 상위 계층 ISP들의 고객
   - 최근에 주요 콘텐츠 제공자도 자신의 네트워크를 구축했고, 가능한 곳에서 하위 게층 ISP과 직접 연결
