-----
### 침입 탐지 시스템 (IDS, Intrusiion Detection System)
-----
1. 패킷 필터(전통적인 필터와 상태 고려 필터)가 어떤 패킷을 방화벽으로 통과시킬지 결저할 때, IP / TCP / UDP / ICMP 헤더 필드를 살펴보지만, 다양한 형태의 공격을 탐지하기 위해서는 헤더 필더 내용 외에도 패킷이 갖고 있는 실제 애플리케이션 데이터 내용까지 살펴보는 자세한 패킷 관찰을 필요
2. 애플리케이션 게이트웨이는 종종 자세한 패킷 관찰을 하지만, 하나의 애플리케이션 게이트웨이는 하나의 애플리케이션에 대해서만 수행
3. 통과하려는 패킷 헤더를 살펴볼 뿐만 아니라, 자세한 패킷 관찰을 수행하는(패킷 필터와 다르게) 새로운 틈새 장치에 대한 요구가 분명히 존재하는데, 그러한 장치가 의심스러운 하나의 패킷이나 패킷들의 의심스러운 연속을 발견했을 때 패킷들이 기관 네트워크로 들어가는 것을 막을 수 있음
   - 패킷은 통과시키되, 네트워크 관리자에게 알려 트래픽을 자세하게 관찰하고 적절하게 행동을 취할 수 있음
   - 이처럼 악의적일 수 있는 트래픽을 발견했을 때, 경고를 발생시키는 장치를 침입 탐지 시스템(IDS, Intrusiion Detection System)
   - 의심스러운 트래픽을 걸러내는 장치를 침입 방지 시스템(IPS, Intrusion Prevention Sysstem)
   - IDS와 IPS를 통틀어 IDS 시스템으로 호칭

4. IDS는 네트워크 구성 정보 수집(예) nmap 이용), 포트 정보 수집 / TCP 스택 정보 수집 / DoS 대역폭 플러딩 공격 / 웜과 바이러스 / OS 취약점 공격 / 애플리케이션 취약점 공격 등 넓은 범위의 공격을 탐지한는데 사용
5. 오늘날 수천 기관들이 IDS 시스템을 이용하지만, 설치된 IDS 시스템이 유명한 스노트(Snort) IDS 시스템과 같은 공개 도메인 시스템
6. 하나의 기관에서 내부 네트워킁에 2개 이상 IDS 센서를 설치 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/1c49ac0e-ea3b-4d38-93a5-e3fb7f161384">
</div>

   - 3개의 IDS 센서를 갖는 기관을 보여주며, 여러 개 센서가 설치되면 일반적으로 함께 협조하면서 일하는데, 의심스러운 트래픽에 대한 정보가 중앙 IDS 프로세서에 전달
   - 중앙 프로세서는 이 정보를 수집하고 통합하여 적당한 때에 네트워크 관리자에게 알림
   - 기관은 네트워크를 패킷 필터와 애플리케이션 게이트웨이에 의해 보호되고, IDS 센서에 의해 감시되는 높은 보안 구역과 패킷 필터와 IDS 센서만 사용 하는 낮은 보안 구역(DMZ(Demilitarized Zone, 비무장 지대)로 지칭)의 두 구역으로 나눔
   - DMZ가 공공 웹 서버, 공인된 DNS 서버와 같은 외부 세계와 통신할 필요가 있는 기관의 서버들을 포함하고 있음

7. 여러 개의 IDS 센서가 필요한 이유
   - IDS가 자세한 패킷 관찰 뿐만 아니라 지나가는 각각의 패킷을 수만 개의 시그니처(Signature)와 비교해야 함
   - 이 작업은 특히 기관의 인터넷으로부터 초당 수 기가비트의 트래픽을 받는 경우에 엄청난 양의 연산이 필요함
   - IDS 센서들을 좀 더 안쪽에 위치시킴으로써, 각 센서는 전체 트래픽의 일부만 관찰하면 되고 좀 더 쉽게 처리 속도 유지 가능
   - 그렇지만 최근에는 고성능의 IDS와 IPS 시스템이 상용화되어 실제로 많은 기관은 접속 라우터 근처에 단 하나의 센서만 두어도 문제 처리 가능

8. IDS 시스템은 넓게 시그니처 기반 시스템(Signature-based System)과 이상 기반 시스템(Abnomaly-based System)으로 분류 가능
   - 시그니처 기반 IDS는 공격 시그니처에 대한 방대한 데이터 베이스를 유지하며, 각 시그니처는 침입 행위에 관련된 규칙들의 집합
     + 시그니처는 단순히 단일 패킷에 대한 특징 목록(출발지와 목적지 포트 번호, 프로토콜 종류, 패킷 페이로드 내 특정 비트열)일 수 있고, 연속된 일련의 패킷들에 관련된 것일 수 있음
     + 일반적으로, 시그니처는 알려진 공격들을 연구하는 숙련된 네트워크 보안 엔지니어들에 의해 만들어지며, 한 기관의 네트워크 관리자는 그 시그니처를 자신에 맞게 수정하고 데이터베이스에 추가 가능
     + 운용 방식은 시그니처 기반 IDS는 지나가는 모든 패킷을 읽어 데이터베이스 내 시그니처들과 비교하며, 만일 어떤 패킷(또는 일련의 연속된 패킷들)이 데이터베이스 내의 시그니처와 일치하면 IDS는 경고를 발생
     + 정확한 시그니처를 생성하기 위해서는 공격에 대한 과거 지식이 필요하다는 제약이 존재 : 즉, 시그니처 기반 IDS는 아직 기록되지 않은 새로운 공격에는 전혀 대비할 수 없으며, 시그니처가 일치한다 하더라도 그것이 실제 어떤 공격 때문이 아닐 수 있고, 그 경우 잘못된 경고가 발생할 수 있으며, 모든 패킷이 방대한 양의 시그니처와 비교되어야 하므로 IDS는 막대한 연산을 처리하지 못해 실제로 많은 악의적 패킷을 감지하지 못할 수 있음

   - 이상 기반 IDS는 평소에 트래픽을 관찰할 때 분석표를 만듬
     + 그 후 ICMP 패킷 빈도가 지나치게 높다던지, 포트 정보 수집과 ping 메세지가 갑자기 증가하는 등 통계학적으로 비정상적 패킷의 스트림을 찾음
     + 현존하는 공격에 대한 과거 지식에 의존하지 않으므로 새로운 공격도 감지해낼 가능성이 존재
     + 한편, 일반적인 트래픽과 통계학적으로 이상한 트래피을 구별해내는 것은 상당히 어려운 문제

   - 지금까지 설치된 대부분 IDS는 이상 기반 시스템을 특성을 약간 포함하긴 하지만, 주로 시그니처 기반 시스템

-----
### 스노트 (Snort)
-----
1. 수십만의 시스템에 설치된 공공 도메인의 오픈 소스 IDS
2. 리눅스, 유닉스, 윈도우 기반에서 동작 가능
3. 일반적인 탐지 인터페이스인 libpcap을 사용하는데, 와이어샤크나 다른 많은 패킷 탐지기에서도 많이 사용
4. 100 Mbps 정도의 트래픽은 쉽게 처리가 가능하나, 초당 기가비트 트래픽을 처리하려면 여러 개의 스노트 센서가 필요
5. 스노트 시그니처의 예
<div align="center">
<img src="https://github.com/user-attachments/assets/709a7432-e3ec-4c7f-ae38-d2ce1b05fd30">
</div>

   - 외부($EXTERNAL_NET)로부터 기관 네트워크($HOME_NET)로 들어온 어떤 ICMP 패킷과 일치하고, 타입은 8(ICMP ping)이며, 데이터 필드는 비어있음(dsize = 0)
   - 이러한 특성을 가진 ping 패킷들을 발생시키므로, 이 시그니처는 nmap ping을 탐지하기 위해 설계된 것
   - 어떤 패킷이 일치하면, 스노트는 "ICMP PING NMAP"이라는 메세지를 포함하는 경고 발생

6. 스노트는 시그니처 데이터베이스를 유지하고 있는 사용자와 보안 전문가의 거대한 커뮤니티
   - 일반적인 새로운 공격이 나타난 지 몇시간 안에 스노트 커뮤니티는 공격 시그니처를 작성, 배포한 뒤 수십만의 스노트 시스템에 다운로드
   - 스노트 시그니처 구문을 이용하여 네트워크 관리자들은 존재하는 시그니처를 수정하고 완전히 새로운 것을 만듦으로써 해당 기관의 필요에 맞는 시그니처 생성 가능
