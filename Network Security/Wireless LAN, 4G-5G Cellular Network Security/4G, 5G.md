-----
### 4G / 5G 셀룰러 네트워크에서의 인증과 키 동의
-----
1. 4G / 5G 환경에서의 상호 인증과 키 생성의 목적들은 802.11 환경에서와 동일
2. 무선 채널로 전송되는 프레임의 내용을 암호화하기 위해, 이동 장치와 기지국은 공유 대칭 암호화 키를 유도할 필요가 있으며, 이동 장치가 접속할 네트워크도 이동 장치의 식별자와 접속 권한을 점검할 필요가 있음
3. 마찬가지로, 이동 장치 또한 접속할 네트워크를 인증하길 원하게 됨
4. 이동 장치가 4G 셀루러 네트워크에 접속하는 시나리오
<div align="center">
<img src="https://github.com/user-attachments/assets/f32f9c02-750b-479e-9902-ffdecb36a404">
</div>

   - 4G 구성 요소로는 이동 장치(M), 이동 장치가 접속하기를 원하는 네트워크 내 기지국(Base Station, BS), 이동성 관리 개체(Mobility Management Entity, MME), 이동 장치의 홈 네트워크의 홈 가입자 서비스(Home Subscriber Service, HSS)를 볼 수 있음
   - 무선 링크를 통해 전송될 프레임의 암호화 / 복호화에 사용될 사용자 세션키 $K_{BS-M}$은 네트워크 접속 시 유도
   - 4G MME와 HSS는 함께 802.11 환경에서의 인증 서버와 유사한 역할을 수행
   - HSS와 이동 장치는 인증이 시작되기 전에 둘 다 알고 있는 공통의 비밀 $K_{HSS-M}$을 공유한다고 가정 : 이 키는 이동 장치의 SIM 카드와 이동 장치 홈 네트워크의 HSS 데이터베이스에 저장

5. 4G 인증과 키 동의(Authentication and Key Agreement, AKA) 프로토콜 구성
   - a : HSS에 인증 요청
     + 이동 장치가 기지국을 경유하여 네트워크에 처음으로 접속 요청을 할 때, 이동 관리 개체(MME)로 전달되는 기기의 국제 이동 가입자 식별자(International Mobile Subscriber Identity, ISMI)를 포함하는 접속 메세지를 보냄
     + MME는 IMSI와 방문지 네트워크 관련 정보(VN)를 이동 장치의 홈 네트워크 내 홈 가입자 서비스(HSS)에 보냄

   - b : HSS로부터 인증 응답
     + HSS는 사전 공유 비밀키인 $K_{HSS-M}$을 사용하여 인증 토큰인 auth_token과 예상되는 인증 응답 토큰인 $xres_{HSS}$를 유도하기 위해 암호화 동작 수행
     + auth_token은 이동 장치로 하여금 auth_token을 계산한 누구든지 비밀키를 알고 있다는 사실을 인지하게 하는 $K_{HSS-M}$를 사용하여 HSS가 암호화된 정보를 포함
     + 예를 들어, HSS가 $K_{HSS-M}(IMSI)$를 계산한다고 하면, 이를 사용하여 이동 장치의 IMSI를 암호화하고 그 값을 auth_token으로 보낸다고 가정
     + 즉, 이동 장치가 암호화된 값을 받고 자신의 비밀키를 활용해 복호화를 수행하며, 이는 $K_{HSS-M}(K_{HSS-M}(IMSI)) = IMSI$를 계산하여, auth_token을 생성한 HSS가 비밀키를 알고 있음을 인지하므로, 이동 장치는 HSS 인증이 가능
     + 예상되는 인증 응답 토큰인 $xres_{HSS}$는 이동 장치가 ($K_{HSS-M}$를 사용하여) 계산에 필요해지는 값을 포함하고 있으며, MME에게 이동 장치가 비밀키를 알고 있음을 증빙함으로써, MME에게 이동 장치가 인증
     + MME만이 인증 응답 메세지를 받고, 향후 사용을 위해 $xres_{HSS}$를 저장하고, 인증 토큰을 추출하여 이동 장치에 전송하는 중간자 역할을 하게 됨 (특히, 비밀키인 $K_{HSS-M}$을 알 필요가 없음)

   - c : 이동 장치로부터의 인증 응답
     + 이동 장치는 auth_token을 받아 $K_{HSS-M}(K_{HSS-M}(IMSI)) = IMSI$를 계산하여 HSS를 인증
     + 이동 장치는 $res_{M}$ 값을 계산하여 (자신의 비밀키를 활용해 HSS가 $xres_{HSS}$를 만들 때 사용한 암호화 계산을 사용), 그 값을 MME에게 보냄

   - d : 이동 장치 인증
     + MMS는 이동 장치가 계산한 $res_{M}$ 값과 HSS가 계산한 $xres_{HSS}$ 값을 비교하여 일치하면 이동 장치는 MME에게 이동 장치와 HSS 모두 공통 비밀키를 알고 있음이 증빙되어 이동 장치가 인증
     + MMS는 기지국과 이동 장치에게 상호 인증이 완료되었음을 알리고, e단계에서 사용할 기지국 키를 보냄

   - e : 데이터 평면과 제어 평면 도출
     + 이동 장치와 기지구근 무선 채널을 통해 프레임 전송에 사용될 암호화 / 복호화 키들을 각자 결정
     + 데이터 평먼과 제어 평면 전송을 위한 개별적 키가 도출되며, AES 암호화 알고리즘이 4G / 5G 네트워크에서도 사용

6. 5G에서의 변화
   - 4G에서 인증 결정을 내리는 것은 MME였으나, 5G 네트워크 보안에서는 방문자 네트워크가 더 작은 중간자 역할을 수행하면서 홈 네트워크에서 제공되는 인증 서비스를 허용하는 것
      + 방문자 네트워크가 이동 장치로부터 인증을 거절할 수 있지만, 5G 시나리오에서는 인증 요청을 받아드리는 것은 홈 네트워크
   - 5G 네트워크는 인증과 키 동의(AKA) 프로토콜을 지원하며, 두 가지의 새로운 인증과 키 동의를 위한 프로토콜도 지원
     + AKA'로 알려져 있으며, 4G의 AKA 프로토콜과 밀접하게 관련
     + 마찬가지로 사전 공유 비밀키인 $K_{HSS-M}$를 사용하나, 802.11 인증에서의 EAP 프로토콜을 사용하므로, 5G AKA' 메세지 흐름은 4G AKA 메세지 흐름과 다름
     + 두 번쨰 새로운 5G 프로토콜은 IoT 환경을 의미하며, 사전 공유 비밀키가 요구되지 않음
   - 또 다른 변화는 장치의 영구적 아이덴티티(자신의 IMSI)를 암호화하기 위해 암호화 기법을 사용해 평문으로 절대 전송하지 않음
