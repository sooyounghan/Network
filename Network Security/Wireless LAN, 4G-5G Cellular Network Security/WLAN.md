-----
### 무선 랜과 4G / 5G 셀룰러 네트워크 보안
-----
1. 공격자가 수신 장치를 송신자의 전송 범위 안에 존재하도록 위치시킴으로써 간단히 프레임들을 알아챌 수 있으므로, 무선 네트워크에서 보안은 특히 중요
2. 이는 802.11 무선 랜 뿐만아니라 4G / 5G 네트워크에도 해당

-----
### 802.11 무선 랜의 인증키와 키 합의
-----
1. 802.11 네트워크에서 다뤄야할 두 가지 핵심적인 보안 관심사
   - 상호 인증 (Mutual Authentication)
     + 이동 장치가 AP(Access Point)에 완전히 접속하여 원거리 호스트에게 데이터그램을 전송하기 전에, 대부분의 경우 네트워크는 접속하는 이동 장치 신원을 확인하고, 그 장치의 접속 권한을 점검하기 위해 장치를 인증하기를 원할 것
     + 마찬가지로, 이동 장치의 경우도 접속하는 네트워크가 진짜 접속을 원하는 네트워크가 맞는지 확인하기 위해 인증하기를 원함
     + 이런 양방향 인증을 상호 인증이라고 함

   - 암호화 (Encryption)
     + 802.11 프레임이 잠재적인 전혀 쓸모 없는 사람들에 의해 알려지거나 조작될 수 있는 무선 채널을 통해 교환될 수 있으므로 이동 장치와 AP 간에 교환되는 사용자 레벨 데이터를 지니고 있는 링크 레벨 프레임 암호화가 중요
     + 암호화와 복호화는 높은 속도로 이루어져야 하므로, 실제로 대칭키 암호화가 사용
     + 이동 장치와 AP는 사용될 대칭 암호화와 복호화 키를 생성해낼 필요가 있음

2. 802.11 네트워크에 접속하기를 원하는 이동 장치의 시나리오
<div align="center">
<img src="https://github.com/user-attachments/assets/eeb9d5b3-c656-4724-8948-1be43541e4bd">
</div>

  - 802.11 네트워크에서 가장 일반적인 네트워크 구성 요소인 이동 장치와 AP 존재
  - 이동 장치를 인증하기 위한 인증 서버(Authentication Server, AS)라는 새로운 구성 요소 존재
    + 인증 서버는 AP와 함께 위치할 수 있고, 인증 서비스를 제공하는 독립적 서버로 구현되는 것이 일반적
  - 인증을 위해 AP는 이동 장치와 인증 서버 간 인증과 키 생성 메세지를 전달하는 경유 장치로서 역할 수행
  - 이러한 인증 서버는 대부분 네트워크 내 모든 AP를 위한 인증 서비스를 제공

3. 상호 인증과 암호화 키 생성 및 사용 절차의 4단계
   - 발견(Discovery) : 발견 단계에서 AP는 자신의 존재와 함께 이동 장치에게 제공될 수 있는 인증과 암호화 형식 제공
     + 이동 장치는 원하는 특정 인증과 암호화 형식 요청
     + 이동 장치와 AP가 이미 메세지를 교환하고 있더라도, 이동 장치는 무선을 통한 프레임 전송을 위해 아직 인증되지 않았고, 암호화 키도 갖고 있지 않으므로, 이동 장치가 AP를 통해 안전한 통신을 하기 전 여러 단계가 더 필요

   - 상호 인증과 공유 대칭키 생성 : 802.11 채널을 안전하게 하는 가장 중요한 단계
     + 상호 인증을 시작하기 전에 인증 서버와 이동 장치 간 이미 공유된 공통의 비밀을 갖고 있다고 가정 (802.11과 4G / 5G는 이렇게 구성되어 있음)
     + 이 단계에서 이동 장치와 인증 서버는 서로 간의 인증에 넌스(릴레이 공격 방지)와 암호화 해싱(메세지 동일성을 확보하기 위해) 등과 함께 공유 비밀을 이용하게 됨
     + 또한 이동 장치와 AP 간의 802.11 무선 링크를 통해 전송될 프레임의 암호화에 사용될 공유 생성하게 됨

   - 공유 대칭 세션키 분배 : 대칭 비밀키는 이동 장치와 인증 서버에서 생성되기에, 인증 서버가 AP에게 공유 대칭 세션키를 알려주기 위한 프로토콜이 필요
   - AP를 통한 이동 장치와 원격 호스트 간의 암호 통신 : 생성되고 분배된 공유 세션키를 사용해 이동 장치와 AP 간의 암호화된 링크 계층 프레임을 가지고 통신이 이루어짐
     + AES 대칭키 암호화는 일반적으로 802.11 프레임 데이터를 암호화 / 복호화하는데 실제로 사용

4. 상호 인증과 공유 대칭 세션키 생성
   - 상호 인증과 공유 대칭키 생성은 802.11 보안의 주요 주제
   - 다양한 초기 802.11 보안 버전의 보안 오류가 여기서 발생했으며, WEP(Wired Equivalent Privacy)라 알려진 802.11 보안 규정에 심각한 보안 오류가 존재
   - WPA1(WiFi Protected Access)은 WEP의 보안 오류를 극복하기 위해 2003년 와이파이 연합에 의해 개발
     + 초기 버전은 메세지 동질성 검사와 사용자가 일정 기간 암호화된 메세지 스트림을 관찰하여 암호화 키를 추측하게 하는 공격을 피하는 것을 도입하여 WEP를 개선
     + AES 대칭키 암호화를 의무화하는 WPA2에 밀려나게 됨

5. 💡 WPA의 핵심은 상호 인증과 함께 공유 대칭 세션키 생성을 수행하는 네 방향 핸드세이크 프로토콜
<div align="center">
<img src="https://github.com/user-attachments/assets/9c5bd00b-c92b-4e51-af19-ff583e5bd640">
</div>

   - 이동 장치(M)와 인증 서버(AS) 모두 공유 비밀키 $K_{AS-M}$(예) 비밀번호)을 알고 시작한다고 가정
   - 이동 장치(M)와 AP 간 정송될 프레임의 암호화 / 복호화에 사용될 공유 대칭 세션키인 $K_{M-AP}$를 생성하는 역할도 존재
   - 상호 인증과 공유 대칭 세션키 생성은 첫 두 단계에서 이루어지며, 나머지 두 단계는 그룹 통신에서 사용되는 두 번쨰 키를 생성하는데 사용
     + a : 첫 번째 단계에서 인증 서버(AS)는 $Nonce_{AS}$를 생성하여 이동 장치로 전송 (넌스는 재생 공격을 피하고 인증 상대방이 활성화되어 있음을 증명하는데 사용)
     + b : 이동 장치 M은 넌스 $Nonce_{AS}$로부터 전송받고, 자신의 넌스인 $Nonce_{M}$을 생성하며, 이동 장치는 $Nonce_{AS}$, 최초 비밀 공유키 $K_{AS-M}$, 이동 장치의 MAC 주소, AS의 MAC 주소를 사용해 대칭형 공유 세션키인 $K_{M-AP}$를 생성
       * 이후, 본인의 넌스 $Nonce_{M}$, $Nonce_{AS}$와 원래 공유 비밀을 암호화한 HMAC-signed 값을 전송
       * 인증 서버는 이동 장치로부터 이 메세지를 받게 되며, 인증 서버는 최근에 전송한 $Nonce_{AS}$의 HAMC-singed 버전을 살펴봄으로, 이동 장치가 활성화되어 있음을 알게 됨
       * 이동 장치는 공유 비밀키인 $K_{AS-M}$을 사용하여 암호화할 수 있고, 인증 서버 또한 이동 장치가 주장하는 본인(즉, 최초 공유 비밀을 알고 있는 공유 장치)라는 것을 알 수 있으므로, 인증 서버는 이동 장치를 인증
       * 인증 서버는 전송받은 $Nonce_{M}$, $Nonce_{AS}$, 최초 공유 비밀키 $K_{AS-M}$, 자신의 MAC 주소와 이동 장치의 MAC 주소를 사용해 이동 장치와 동일한 계산을 수행해 공유 대칭 세션키 $K_{M-AP}$를 계산
     + c, d : AS는 AP에게 이 키 값을 전달

6. WPA3는 WPA2를 개선하여 2018년 6월에 공개
   - 이전에 사용했던 넌스의 재사용 유도가 가능한 네 방향 핸드세이크 프로토콜에 대한 공격을 강조했으나, 아직 네 방향 핸드세이크 사용을 허용하고 있으며, 다른 변경 중에 더 긴 키 길이를 포함하고 있음

-----
### 802.11 보안 메세징 프로토콜
-----
1. 802.11 보안 프레임워크를 구현하기 위해 사용된 프로토콜
<div align="center">
<img src="https://github.com/user-attachments/assets/b6adafa7-2429-43d1-ad94-50ee29b572bb">
</div>

2. 확장 인증 프로토콜(Extensible Authentication Protocol, EAP)은 이동 장치와 인증 서버 간 단순한 요청 / 응답 모드의 상호작용에 사용되는 종단간 메세지 포맷 정의하며, WPA2 하에 인증
3. EAP 메세지들은 EAPoL(EAP over LAN)을 사용하여 캡슐화되며, 802.11 무선 링크로 전송
4. 이러한 EAP 메세지들은 AP에서 역캡슐화되며, RADIUS 프로토콜을 사용하여 재캡슐화되어 UDP/IP를 통해 인증 서버로 전송
5. RADIUS 프로토콜이 요구되지 않지만, 사실상 표준의 일부분이며, 최근에 표준화된 DIAMETER 프로토콜은 미래에 궁극적으로 RADIUS 프로토콜을 대치할 것으로 예상
