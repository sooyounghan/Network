-----
### 전통적인 패킷 필터
-----
1. 하나의 기관은 일반적으로 내부의 네트워크를 ISP에 연결하는 게이트웨이 라우터를 가짐
2. 내부 네트워크에 대한 모든 입출력 트래픽은 이 라우터를 통과해야 하고, 이 라우터에서 패킷 필터링(Packet Filtering)이 일어남
3. 패킷 필터는 각 데이터그램을 따로따로 독립적으로 관리하면서 관리자의 특정한 규칙에 따라 데이터그램을 통과시킬지 버릴지 결정
4. 필터링 결정의 근거
   - IP 출발지 또는 목적지 주소
   - IP 데이터그램 내의 프로토콜 타입 : TCP, UDP, ICMP, OSPF 등
   - TCP 또는 UDP 출발지와 목적지 포트
   - TCP 플래그 비트 : SYN, ACK 등
   - ICMP 메세지 타입
   - 네트워크에서 나가는 데이터그램과 들어오는 데이터그램에 대한 서로 다른 규칙들
   - 서로 다른 라우터 인터페이스에 대한 서로 다른 규칙들

5. 네트워크 관리자 기관의 정책에 기초해 방화벽을 설정하며, 정책은 기관의 보안 문제뿐만 아니라 사용자의 생산성과 대역폭 사용률도 고려할 것
6. 하나의 기관이 가질 수 있는 많은 가능한 정책을 나열하고 패킷 필터에 어떻게 반영했는지 보여주는 표
<div align="center">
<img src="https://github.com/user-attachments/assets/a301f890-cf11-4325-a37a-179ffa390c50">
</div>

  - 어떤 기관이 공개 웹 서버 접속 목적을 제외한 어떠한 TCP 연결도 받아들이기 원하지 않을 경우 : 목적지 포트 80번과 웹 서버에 해당하는 목적지 주소를 가진 TCP SYN 세그먼트를 제외한 모든 입력 TCP SYN 세그먼트를 막을 수 있음
  - 한 기관이 그들의 사용자가 인터넷 라디오 애플리케이션으로 대역폭을 독점하는 것을 원하지 않을 경우 : 특별하 중요하지 않은 모든 UDP 트래픽을 막을 수 있음 (인터넷 라디오는 보통 UDP를 통해 서비스)
  - 또한, 내부 네트워크 구조가 외부인에게 알려지는 것을 원하지 않을 경우 : 기관 네트워크에서 나가는 TTL이 만료된 모든 ICMP 메세지를 막으면 됨

7. 필터링 정책은 주소와 포트 번호의 조합에 기초
   - 예를 들면, 필터링 라우터는 특정한 IP 주소 목록에 해당하는 것들을 제외한 모든 텔넷 데이터그램(포트 번호 23번)을 전달할 수 있으며, 이 정책은 허가된 목록에 있는 호스트에서 또는 호스트로의 텔넷 연결을 허락
   - 💡 그러나 외부 주소에 기초한 정책은 출발지 주소를 위장(Spoofing)인 데이터그램을 막을 수 없음

8. 필터링은 TCP ACK 비트가 설정되어 있는지 여부에 기초
   - 내부의 클라이언트가 외부 서버에 연결하는 것은 가능하나 외부 클라이언트가 내부 서버에 연결하는 것은 막고 싶을 때 유용
   - 모든 TCP 연결의 첫 번쨰 세그먼트는 ACK 비트가 0인 반면, 다른 모든 세그먼트의 ACK 비트는 1
     + 간단하게 ACK 비트가 0인 입력 세그먼트를 걸러내면, 외부 클라이언트가 내부 서버로의 연결을 설립하지 못하게 할 수 있음
     + 이런 정책은 외부에서 오는 모든 TCP 연결은 허용하지 않지만, 내부에서 나가는 건 허락

9. 방화벽의 규칙은 접속 제어 목록과 함께 라우터에 구현
   - 각 라우터 인터페이스는 자신만의 목록을 가짐
   - 예) 네트워크 번호가 ```222.22/16```인 기관의 접속 제어 목록의 예
<div align="center">
<img src="https://github.com/user-attachments/assets/147d359b-6738-4ddf-b004-b3ec21b6a1d3">
</div>

   - 이 목록은 라우터를 기관 외부 ISP와 연결하는 인터페이스를 위한 것이며, 규칙들은 인터페이스를 통과하는 모든 데이터그램에 적용
   - 처음 두 규칙은 함꼐 내부 사용자의 웹 서핑을 가능하게 함
     + 첫 번쨰 규칙은 목적지 포트 번호가 80인 모든 TCP 패킷이 기관 네트워크에서 나갈 수 있도록 함
     + 두 번째 규칙은 출발지 포트 번호가 80이고 ACK 비트가 1인 TCP 패킷이 들어오는 것을 허용
     + 출발지 또는 목적지 포트 번호가 80이라 할지라도 외부의 호스트가 먼저 내부 호스트에 TCP 연결을 설정하려는 시도는 허용되지 않음

   - 다음 2개의 규칙은 DNS 패킷의 출입을 허용
   - 다소 제한적인 접속 제어 목록은 기관 내부에서 시작된 웹 트래픽과 DNS 트래픽을 제외한 모든 트래픽을 막음

10. [CERT Filtering 2012]는 현존하는 네트워크 애플리케이션들의 알려진 많은 보안 허점을 피하기 위한 권장 포트 / 프로토콜 패킷 필터링 항목 제공
