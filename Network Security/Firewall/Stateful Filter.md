-----
### 상황 고려 패킷 필터
-----
1. 전통적인 패킷 필터에서는 패킷 차단 결정이 각 패킷에 대해 별개로 이루어지지만, 상황 고려 패킷 필터는 TCP 연결을 추적하여 이 정보를 패킷 차단 결정 하는데 이용
<div align="center">
<img src="https://github.com/user-attachments/assets/4f0e2146-f408-41dd-9338-a284d86d9a1d">
</div>

  - 접속 제어 목록은 ACK = 1 그리고 출발지 포트 80을 가진 모든 패킷이 필터를 통과해 내부로 들어오는 것 허용하며, 그러한 패킷들은 조작된 패킷으로 내부 시스템을 파괴하려 하거나 DoS 공격, 네트워크 내부 구조를 알아내려는 공격자에게 이용될 수 있음
  - 단순한 해결책은 TCP ACK 패킷을 막는 것이지만, 이럴 경우 기관 내부 사용자도 웹 서핑을 할 수 없게 됨

2. 상황 고려 필터는 이러한 문제를 연결 테이블에 있는 진행 중인 모든 TCP 연결을 추적함으로써 해결
   - 방화벽이 세 방향 핸드세이크(SYN, SYNACK, ACK)를 관찰함으로써 새로운 연결의 시작을 알 수 있고, 그 연결에 대해 FIN을 발견함으로써 연결의 종료를 알 수 있기 때문에 가능
   - 방화벽은 또한 어떤 연결이 일정 시간(예를 들어, 60초 동안 전혀 사용되지 않으면) 그 연결은 종료되었다고 가정 가능
   - 방화벽을 위한 연결 테이블 예 : 이 연결 테이블은 현재 3개의 TCP 연결이 진행 중이고, 모두 기관 내부에서 시작된 연결
<div align="center">
<img src="https://github.com/user-attachments/assets/fc9b7550-e058-40b8-8fc2-78e694637f44">
</div>

   - 상황 고려 필터는 접속 제어 목록에 '연결 검사'라는 새로운 열을 포함
<div align="center">
<img src="https://github.com/user-attachments/assets/1d5a70f9-7f0e-4f9c-870a-99168a3d66cd">
</div>

   - 규칙들 중 두 가지 항목에 대한 연결을 검사해야 함

3. 연결 테이블과 확장된 접속 제어 목록이 사용되는 예
   - 공격자가 조작된 패킷을 TCP 출발지 포트 80번, ACK 플래그 1로 설정하여 기관 네트워크 내부로 보내려 한다고 가정
   - 이 패킷은 출발지 포트 번호 12543번, 출발지 IP 주소를 ```150.23.23.155```를 갖고 있다고 가정
     + 패킷이 방화벽에 도착하면 방화벽은 접속 제어 목록을 확인하는데, 이 패키이 기관 네트워크로 들어가는 것을 허가하기 전 연결 테이블이 반드시 검사되어야 한다고 표시
     + 따라서, 방화벽은 연결 테이블을 검사하게 되고, 이 패킷이 진행 중인 TCP 연결 어느 것에도 속해있지 않게 되므로, 패킷은 버려짐

   - 내부 사용자가 외부 웹사이트에 방문하려 한다고 가정
     + 이 사용자가 먼저 TCP SYN 세그먼트를 보내기 때문에 이 TCP 연결은 연결 테이블에 기록
     + 웹 세버가 패킷(ACK 비트가 1로 설정되어 있다고 가정)을 역으로 보내오면, 방화벽은 테이블을 검사하고 해당 연결이 진행 중임을 알게 되므로, 방화벽은 패킷을 통과시킬 것이고, 내부 사용자는 웹 서핑을 하는데 방해 받지 않음

