-----
### 콘텐츠 분배 네트워크 (CDN)
-----
1. 인터넷 비디오 회사에서 스트리밍 서비스를 제공하는 가장 단순한 방법 : 단일한 거대 데이터 센터를 구축하고 모든 비디오 자료를 데이터 센터에 저장한 뒤, 전 세계 사용자에게 비디오 스트림을 데이터 센터로부터 직접 전송
   - 클라이언트가 데이터 센터로부터 지역적으로 먼 지점에 있는 경우, 서버로부터 클라이언트로의 패킷 경로는 많은 다양한 통신 링크와 ISP를 거쳐 가는데, 이러한 ISP는 각 다른 대륙에 위치할 수 있음 (비디오 소비율보다 낮은 전송 용량을 가지면, 종단 간 처리율이 낮아지고 화면 정지 현상 발생 가능)
     + 종단 간 경로 길이가 길어질수록 더욱 심해짐
   - 인기 있는 비디오는 같은 통신 링크를 통해 여러 번 반복적으로 전송될 것이므로, 네트워크 대역폭 낭비는 물론 인터넷 비디오 회사는 회선을 제공하는 ISP들에게 동일한 바이트를 전송하는 것에 대해 중복 비용을 지불하는 결과 초래
   - 단일한 데이터 센터를 구축하면, 한 번의 장애로 인해 전체 서비스가 중단될 위험 존재 (스트리밍 서비스 불가능)

2. 해결안 : 콘텐츠 분배 네트워크(CDN)
   - 다수의 지점에 분산된 서버를 운영하며, 비디오 및 다른 형태의 웹 콘텐츠 데이터의 복사본을 분산 서버에 저장
   - 사용자는 최선의 서비스와 사용자 경험을 제공할 수 있는 지점의 CDN 서버로 연결되며, CDN은 콘텐츠 제공자가 소유한 사설 CDN(Private CDN)일 수 있음
   - 또는 제3자가 운영하는 CDN을 통해 다수의 콘텐츠 제공자가 서비스할 수 있는데, 이를 Thrid-Party CDN

3. CDN 서버의 위치
   - Enter Deep
     + 서버 클러스터를 세계 곳곳 접속 네트워크에 구축하며, ISP 접속 네트워크로 깊숙히 들어가는 것
     + 즉, 수천 개의 지점에 서버 클러스트를 구축하는 것
     + 서버를 최대한 사용자 가까이 위치시켜 사용자와 CDN 서버 사이 링크 및 라우터 수를 줄이고, 사용자가 경험하는 지연 시간 및 처리율 개선
     + 문제점 : 고도로 분산된 설계로 인해 서버 클러스터를 유지 관리하는 비용이 커짐

   - Bring Home
     + 좀 더 적은 수의 핵심 지점에 큰 규모의 서버 클러스터를 구축하여 ISP를 Home으로 가져오는 개념
     + 접속 ISP에 연결하는 대신, CDN들은 클러스터를 인터넷 교환 지점(IXP, Internet Exchange Point)에 배치
     + 위 방법에 비해 클러스터 유지 및 관리 비용 절감되지만, 사용자가 느끼는 지연 시간과 처리율은 상대적으로 나빠짐

4. 서버 클러스터 위치가 결정되면 CDN은 콘텐츠의 복사본을 클러스터에 저장
   - CDN은 각 클러스터마다 모든 비디오의 복사본을 전부 유지할 필요가 없음
   - 실제 CDN은 클러스터에 대해 푸시(Push)방식이 아닌 풀(Pull) 방식 사용
   - 즉, 사용자가 지역 클러스터에 없는 비디오를 요청하면, 해당 비디오를 중앙 서버나 다른 클러스터로부터 전송받아 사용자에게 서비스하는 동시에 복사본을 만들어 저장
   - 클러스터 저장 공간이 가득차면, 자주 사용되지 않는 비디오 데이터는 삭제

5. CDN 동작
   - 사용자 호스트의 웹 브라우저가 URL을 지정함으로 특정 비디오 재생을 요청하면 CDN은 이 요청을 가로챔
   - 그 시점에 클라이언트에게 가장 적당한 CDN 클러스터 선택
   - 클라이언트 요청을 해당 클러스터의 서버로 연결
   - 대부분의 CDN은 사용자의 요청을 가로채고 다른 곳으로 연결하기 위해 DNS 활용
     + 예) NetCinema라는 콘텐츠 제공자가 KingCDN이라는 CDN 업체를 이용해 비디오를 고객게 분배
       * NetCinema의 웹 페이지는 각 비디오가 'video'라는 문자열과 고유한 ID를 포함하는 URL를 할당받음
<div align="center">
<img src="https://github.com/user-attachments/assets/0ea06e6a-348f-4a3d-b9ac-05d318f9d4a2">
</div>

   - 사용자가 NetCinema의 웹 페이지를 방문
   - 사용자가 해당 링크를 클릭하면, 사용자 호스트는 ```video.netcinema.com```에 대한 DNS 질의를 보냄
   - 사용자의 지역 DNS 서버(LDNS)는 호스트 이름의 'video' 문자열을 감지
     + 해당 질의를 NetCinema의 책임 DNS 서버로 전달
     + NetCinema 책임 DNS 서버는 해당 DNS 질의를 KingCDN으로 연결하기 위해 IP 주소 대신 KingCDN의 호스트 이름을 LDNS에게 알려줌
   - DNS 질의는 KingCDN의 사설 DNS 구조로 접속
     + 사용자의 LDNS는 이에 대해 KingCDN의 호스트 이름에 대해 두 번째 질의를 보내고 이는 KingCND의 DNS에 의해 KingCDN 콘텐츠 서버의 IP 주소로 변환되어 LDNS에게 응답
     + 즉, 클라이언트가 콘텐츠를 전송받게 될 서버가 결정
   - LDNS는 콘텐츠를 제공할 CDN 서버의 IP 주소를 사용자 호스트에게 알려줌
   - 클라이언트는 KingCDN 서버의 IP 주소를 얻고 나면, 해당 IP 주소로 직접 TCP 연결을 설정하고 비디오에 대한 HTTP GET 요청 전송
     + 만약 DASH를 사용한다면, 서버는 먼저 각기 다른 버전의 비디오에 대한 URL 목록을 포함하는 매니페스트 파일을 클라이언트에게 먼저 전송하고, 클라이언트는 동적으로 각기 다른 버전의 비디오 조각 단위 데이터 선택 가능

6. 클러스터 선택 정책
   - 클라이언트를 동적으로 어떤 서버 클러스터 또는 CDN 데이터 센터로 연결하는 방식
   - CDN은 클라이언트가 DNS 서비스를 수행하는 과정에서 클라이언트의 LDNS 서버의 IP 주소를 알게 되며, IP 주소를 알게 된 CDN은 해당 IP 주소에 기초해 최선의 클러스터를 선택할 필요가 있으므로, CDN은 고유한 클러스터 선택 정책 사용
   - 클라이언트에게 지리적으로 가장 가까운 클러스터를 할당하는 기법
     + DNS 질의가 특정 LDNS로 도착하면 CDN은 해당 LDNS에서 가장 가까운 클러스터 선택
     + 일부 클라이언트는 잘 동작하지 않을 수 있음 : 지리적으로 가장 가까운 클러스터가 네트워크 경로의 길이 홉(hop) 수에 따라 가장 가까운 클러스터가 아닐 수 있음
     + DNS 기반 방법에 내재된 문제로, 일부 사용자는 멀리 있는 DNS 서버를 LDNS로 사용하도록 설정할 수 있음
     + 이 경우 LDNS의 IP 주소를 기반으로 선택한 클러스터는 사용자 호스토루벝 멀리 위치되며, 인터넷 경로 지연이나 가용 대역폭 변화 등은 무시하고 항상 같은 클러스터를 클라이언트에게 할당
   - 현재의 네트워크 트래픽 상황을 반영한 최선 클러스터 선택을 위해 주기적으로 CDN은 클러스터와 클라이언트 간 지연 및 손실 성능에 대한 실시간 측정을 수행하기 도함

-----
### 넷플릭스, 유튜브
-----
1. 넷플릭스
   - 넷플릭스 비디오 배포 구성 요소 : 아마존 클라우드와 자체 CDN 인프라
   - 아마존 서버 안에 아마존 클라우드에서 모든 것이 실행
<div align="center">
<img src="https://github.com/user-attachments/assets/388a3386-8e01-453d-adca-fa471bae9f48">
</div>

  - 콘텐츠 수집 : 넷플리스는 고객들에게 비디오를 분배하기 전 먼저 영화를 수집하고 처리 (영화의 스튜디오 마스터 버전을 받아 아마존 클라우드 시스템의 호스트에 업로드)
  - 콘텐츠 처리 : 아마존 클라우드 시스템 기기에서 다양한 플레이어 기기 사양에 적합하도록 각 영화의 여러 가지 형식 비디오를 생성
    + DASH를 이용한 HTTP 적응적 스트리밍 서비스를 위해 각 형식별 다양한 비트율의 여러 가지 버전 생성
  - CDN으로 버전 업로드 : 영화의 다양한 버전이 생성되면, 아마존 클라운드 시스템 호스트는 이러한 버전을 CDN으로 업로드할 수 있음
  - 넷플릭스 CDN은 Pull-Caching이 아닌 Push-Caching 사용 (콘텐츠는 캐시 미스 중 동적으로 사용되는 것이 아닌 사용량이 적은 시간 중 예약된 시간에 서버에 푸시)

2. 유튜브
   - 구글은 자체 비공개 CDN을 사용하여 유튜브 동영상 배포 및 수백 가지의 IXP 및 ISP 위치에 서버 클러스터를 설치
   - 거대한 데이터 센터에서 직접 동영상을 배포
   - 사용자를 특정 서버 클러스터와 연결하는데 DNS를 사용하며, 구글의 클러스터 선택 정책은 클라이언트와 클러스터 간 RTT가 가장 적은 곳을 연결
   - 떄로는 클러스터 간 균형 있는 작업 부하를 위해 클라이언트가 DNS를 통해 좀 더 멀리 있는 클러스터에 연결되기도 함
   - HTTP 스트리밍을 채용하고 있으며, 보유한 비디오에 대해 각기 다른 비트율과 품질을 갖는 여러 단계 버전을 생성하여 제공
   - DASH 같은 적응적 스트리밍 대신 2011년에 사용자가 스스로 버전을 선택하게 변경
