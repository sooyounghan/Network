-----
### P2P 구조
-----
1. 인프라스트럭쳐 서버에 최소한(또는 하지 않음)에 의존
2. 대신, 간혈적으로 연결되는 호스트 쌍들(Peer)이 서로 직접 통신

-----
### P2P 구조의 확장성
-----
1. 서버의 피어들은 접속 링크로 인터넷에 연결
2. 서버의 접속 링크 업로드 속도를 $u_{s}$로, $i$번째 피어의 접속 링크 업로드 속도로 $u_{i}$로, 그리고 $i$번째 피어의 접속 링크 다운로드 속도는 $d_{i}$
   - 분배되는 파일의 크기는 $F$(단위는 비트)로, 파일의 복사본을 얻고자 하는 피어들의 수는 $N$으로 나타냄
   - 분배 시간은 모든 $N$개의 피어들이 복사본을 얻는데 걸리는 시간
   - 인터넷 코어가 풍부한 대역폭을 갖고 있다는 간단한 가정을 하며, 모든 병목 현상은 네트워크 접속 부분에 있음을 의미
   - 클라이언트 서버는 다른 네트워크 애플리케이션에 참여하지 않아 이들의 모든 업로드와 다운로드 접속 대역폭은 이 파일 분배에 모두 사용
<div align="center">
<img src="https://github.com/user-attachments/assets/f41b5709-7e92-4dcf-92b5-024f1a047e83">
</div>

3. 클라이언트-서버 구조에 대한 분배 시간($D_{cs}$)을 결정
   - 클라이언트-서버 구조에서는 어떤 피어도 파일을 분배하는데 도움을 주지 않음
   - 서버는 파일 복사본을 N개의 피어 각각에게 전송해야 하는데, 서버는 NF 비트를 전송해야 하므로, 서버의 업로드 속도가 $u_{s}$이므로 파일 분배 시간은 적어도 $NF / u_{s}$
   - $d_{min}$이 가장 낮은 다운로드 속도를 가진 피어의 다운로드 속도를 나타낸다고 하면, $d_{min}$ = min ($d_{1}, d_{2}, ..., d_{N}$)
   - 가장 낮은 다운로드 속도를 가진 F / $d_{min}$초보다 적은 시간에 파일의 모든 F비트를 얻을 수 없으므로, 최소 분배 시간은 F / $d_{min}$
<div align="center">
<img src="https://github.com/user-attachments/assets/3d8f7c0c-914f-4f3b-ad14-d0b30c1337a9">
</div>

   - 클라이언트-서버 구조에 대한 최소 분배 시간의 하한값을 제공
   - 충분히 큰 N에 대해 클라이언트-서버 분배 시간은 NF / $u_{s}$로 주어지며, 분배 시간은 피어의 수 N에 따라 선형적으로 증가

4. P2P 구조
   - 각 피어들이 서버가 파일을 분배하는데 도움을 줄 수 있는데, 한 피어가 파일 데이터 일부를 수신할 때, 피어는 그 데이터를 다른 피어들에게 재분배하는데 자신의 업로드 용량을 이용할 수 있음
   - 분배 시간을 계산하는 방법은 클라이언트-서버 구조 경우보다 좀 더 복잡한데, 분배 시간이 각 피어가 다른 피어들에게 파일의 일부를 어떻게 분배하느냐에 따라 달려있기 때문임

   - 분배가 시작되면 서버만이 파일을 가지고 있는데, 이 파일이 피어 커뮤니티에 도달할 수 있도록 하기 위해, 서버는 적어도 한 번 접속 링크로 파일의 각 비트를 보내야 함
   - 따라서, 최소 분배 시간은 적어도 $F / u_{s}$ (서버가 한 번 보낸 비트는 다시 보낼 필요가 없는데, 이는 클라이언트-서버와 달리 피어들이 그들 사이에 이 비티를 재분배할 수 있기 때문임)
   - 클라이언트-서버 구조와 마찬가지로 다운로드 속도가 가장 낮은 피어는 $F / d_{min}$초 보다 적은 시간 안에 파일의 모든 F 비트를 얻을 수 없으므로, 적어도 이 시간임
   - 마지막으로, 시스템 전체 업로드 용량은 전체적으로 서버의 업로드 속도와 각 피어들의 업로드 속도를 더한 것이므로, $u_{total} = u_{s} + u_{1} + ... + u_{N}$
     + 시스템은 N개의 피어들 각각에게 F비트를 전달(업로드)해야 하는데, 이는 $u_{total}$보다 더 빠른 속도로 할 수 없으므로, 최소 분배 시간은 적어도 $NF / (u_{s} + u_{1} + ... + u_{N})$
   - P2P에 대한 최소 분배 시간 ($D_{P2P}$)
<div align="center">
<img src="https://github.com/user-attachments/assets/a14d0836-41ad-4068-b5ae-f68b1dfd4023">
</div>

   - 즉, P2P 구조에 대한 최소 분배 시간에 대한 하한값을 제공
   - 각 피어가 비트를 수신하자마자 그 비트를 재분배할 수 있다고 가정한다면, 이 하한값을 실제로 얻는 재분배 방식이 존재
   - 현실적으로는 개별적 비트보다는 파일의 청크(Chunk)가 재분배되는데, 최소 분배 시간에 대한 좋은 근삿값을 제공

5. P2P 구조와 클라이언트-서버 구조의 분배 시간
<div align="center">
<img src="https://github.com/user-attachments/assets/743f9248-3649-4f9f-8dfe-ef077d6a7b61">
</div>

   - 모든 피어가 같은 업로드 속도 $u$를 갖고 있다고 가정
   - $F / u$ = 1시간, $u_{s}$ = 10 $u$, $d_{min}$ ≥ $u_{s}$로 설정
     + 따라서, 전체 파일을 한 시간안에 보낼 수 있고, 서버 전송률은 피어 업로드 속도에 10배이며, 피어 다운로드 속도는 영향을 받지 않을 정도로 충분히 크게 설정
   - 클라이언트-서버의 경우 피어의 수가 증가함에 따라 분배 시간이 선형적으로, 그리고 한계 업이 증가하지만, P2P 구조는 최소 분배 시간이 클라잉너트-서버 구조의 분배 시간보다 항상 작지 않으며, 임의의 피어 수 N에 대해 한 시간보다 작음
   - 따라서, P2P 구조를 가진 애플리케이션은 자가 확장성을 가지며, 이 확장성은 피어가 비트의 소비자이자 재분배자인 것의 직접적 결과

6. 비트토렌트
   - 파일 분배를 위한 인기 있는 P2P 프로토콜
   - 토렌트(Torrent) : 비트토렌트 용어로 특정 파일의 분배에 참여하는 모든 피어의 모임
   - 토렌트에 참여하는 피어들은 서로에게 같은 크기의 청크(Chunk)를 다운로드하며, 일반적인 청크의 크기는 256 KB
   - 피어가 처음으로 토렌트에 가입하면, 그 피어에는 청크가 없지만 시간이 지남에 따라 많은 청크가 쌓이며, 피어가 청크를 다운로드할 때 피어는 또한 청크를 다른 피어들에게 업로드
   - 한 피어가 전체 파일을 얻으면, 토렌트를 떠날 수 있거나 혹은 남아서 다른 피어들로 청크를 계속해서 업로드 할 수 있으며, 어떤 피어는 일부 청크만 가진 채 토렌트를 떠날 수 있으며, 나중에 토렌트에 재가입 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/3e282ea2-7833-4bc2-b28b-e6dec8bab60b">
</div>

   - 토렌트는 트래커(Tracker)라는 인프라스트럭쳐 노드를 가지고 있으며, 한 피어가 토렌트에 가입할 때 트래커에 자신을 등록하고 주기적으로 자신이 아직 토렌트에 있음을 알림
     + 트래커는 토렌트에 참여하는 피어들을 추적하며, 주어진 토렌트는 어느 순간 수백 혹은 수천의 피어들이 참여할 수 있음
   - 피어 집합에서 임의의 피어들로 부분집합을 선택해 피어들의 IP 주소(피어들의 목록)을 전송하면 얻게 되는데, 이 목록에 있는 모든 피어와 동시에 TCP 연결을 설정하며, TCP 연결을 설정한 모든 피어를 '이웃 피어'라고 부름
     + 시간이 지남에 따라 피어들 중 일부는 떠나고 다른 피어들이 TCP와 ㅇ녀결을 시도하므로, 피어의 이웃 피어들은 시간에 따라 변동
     + 어느 청크를 요청할 것인지에 대해서는 가장 드문 것 먼저(Rarest First) 기술 사용 (즉, 갖고 있지 않은 청크 가운데, 즉 이웃 가운데 가장 드문 청크(가장 적은 반복 복사본을 가진 청크)를 결정하고 가장 드쿤 청크를 요구하는 것)
     + 가장 드문 청크들은 더 빨리 재분배될 수 있으므로 토렌트에 각 청크의 복사본 수가 대략적으로 동일해짐
   - 현명한 교역(Trading) 알고리즘을 사용 : 가장 빠른 속도로 데이터를 제공하는 이웃에게 우선순위를 주는 것
     + 활성화(Unchocked)된 피어 : 비트를 수신하는 속도를 측정하여 가장 빠르게 전송하는 피어를 결정
     + 낙관적으로 활성화(Optimistically Unchocked) : 이 중 임의로 선택된 피어
     + 즉, 임의로 선택된 피어를 선택하고 교역을 시작하며, 빠르게 전송하는 피어들 중 가장 좋은 피어를 하나 선택 후, 더 좋은 피어를 만나기전까지 서로 교역을 계속하는 것
     + 효과로는 양립할 수 있는 속도로 업로드할 능력을 가진 피어들이 서로를 찾으려는 경향이 있으며, 임의의 이웃 선택은 새로운 피어들이 청크를 얻게하여 그들이 교역할 수 있는 무엇인가를 가질 수 있음
   - 논의하지 않은 조각(Pieces, 미니청크), 파이프라이닝(Pipelining), 무작위 우선 선택(Random First Selection), 마지막 게임 모드(Endgame Mode), 안티스너빙(Anti-Snubbing) 등 포함하는 흥미로운 기법을 많이 가짐
   - 보상 방식 : TFT(Tit-For-Tat) : 회피 가능
   - DHT(Distriutred Hash Table, 분산 해시 테이블) : 데이터베이스 레코드가 P2P 시스템 피어에 분산되어 있는 단순한 데이터베이스로, 다양하게 구현되어 있음
