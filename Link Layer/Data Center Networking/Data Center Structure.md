-----
### 데이터 센터 구조
-----
1. 데이터 센터에서 작업을 수행하는 것은 호스트
   - 데이터 센터 호스트는 피자 박스 모양의 블레이드(Blade)라고도 불리며, CPU / 메모리 / 디스크 저장장치를 갖고 있는 범용 호스트
   - 데이터 센터의 호스트들은 20 ~ 40대의 블레이드를 적재할 수 있는 랙(Rack)에 적재
   - 랙의 맨 위에는 TOR(Top Of Rack) 스위치라고 불리는 쉬이치가 존재하며, 랙에 있는 호스트들을 연결해주고 데이터 센터의 다른 스위치들과 연결
   - 랙에 있는 호스트는 네트워크 인터페이스 카드를 통해 TOR 스위치에 연결되며, TOR 스위치는 다른 스위치로 연결될 수 있는 포트들을 추가로 가지고 있음
   - 요즘 호스트는 보통 40 Gbps 또는 100 Gbps 이더넷으로 TOR 스위치에 연결되어 있으며, 호스트는 데이터 센터 내부에서 사용되는 자신만의 IP 주소를 할당받음

2. 데이터 센터 네트워크는 외부 클라이언트와 내부 호스트 사이의 트래픽과 내부 호스트 간의 트래픽 등 두 종류 트래픽을 지원
   - 외부 클라이언트와 내부 호스트 간 트래픽 플로우를 처리하기 위해 데이터 센터 네트워크는 하나 이상 경계 라우터(Border Router)를 가짐
   - 경계 라우터는 데이터 센터 네트워크를 공중 인터넷으로 연결해줌
   - 따라서, 데이터 센터 네트워크는 랙을 서로 연결해주고, 랙을 경계 라우터로 연결해줌
<div align="center">
<img src="https://github.com/user-attachments/assets/5e2d942c-103c-4291-a8d5-da88cd823cde">
</div>

-----
### 로드 밸런싱
-----
1. 클라우드 데이터 센터는 여러 애플리케이션을 제공
   - 외부 클라이언트로부터의 요청을 지원하기 위해, 애플리케이션에는 공용 IP 주소가 할당되어 클라이언트는 이 IP 주소로 요청을 보내고 이 IP 주소로부터 응답을 받음
   - 데이터 센터에서는 외부로부터의 요청이 들어오면 먼저 로드 밸런서(Load Balancer)로 보내며, 로드 밸런서는 요청을 호스트로 분배하고 호스트의 현재 부하 상태에 따라 호스트 간 부하를 균등하게 함
   - 대규모 데이터 센터의 경우 일반적으로 여러 대의 로드 밸런서를 가지고 있으며, 각 로드 밸런서는 특정 클라우드 애플리케이션을 위해 사용

2. 로드 밸런서는 패킷의 목적지 IP 주소 뿐만 아니라 목적지 포트 번호(4계층)을 보고 결정하므로 로드 밸런서를 4계층 스위치라고도 함
   - 특정 애플리케이션에 대한 요청을 받은 로드 밸런서는 해당 애플리케이션을 처리하는 호스트 중 하나로 요청을 전달
   - 그러면 호스트는 요청을 처리하기 위해 다른 호스트에게 도움을 청함
   - 로드 밸런서는 호스트 간 로드 밸런싱을 수행할 뿐만 아니라 호스트의 공용 외부 IP 주소를 내부 IP 주소로 변환해주고 클라이언트 쪽으로 역방향으로 가는 패킷 내부 IP 주소를 공용 외부 IP 주소로 변환해주는 NAT와 유사한 기능 제공
   - 즉, 클라이언트가 호스트가 직접 통신하지 못하게 하며, 내부 네트워크 구조를 숨기고 클라이언트가 호스트와 직접 상호작용하지 못하게 함으로써 보안 제공

-----
### 계층적 구조
-----
1. 단지 수천 개의 호스트만 갖고 있는 소규모 데이터 센터는 경계 라우터 1개, 로드 밸런서 1대, 단일 이더넷 스위치만으로도 모두 연결 가능한 수십 개 랙으로 구성된 간단한 네트워크만으로도 충분
   - 따라서, 라우터와 스위치의 계층 구조를 채택
   - 계층 구조 최상단에는 경계 라우터가 접속 라우터에 연결
   - 접속 라우터 아래에는 세 단(Tier)의 스위치들이 있음
   - 접속 라우터는 최상단 스위치에 연결되고, 최상단 스위치는 여러 개의 두 번쨰 단 스위치들과 로드 밸런서에 연결
   - 두 번쨰 단 스위치는 랙의 TOR 스위치(세번째 단 스위치)를 통해 여러 랙으로 연결됨
   - 일반적으로 모든 링크는 링크 계층 및 물리 계층 프로토콜로 이더넷을 사용하며, 이러한 계층 구조 설계를 사용함으로써 데이터 센터는 수십만 대 호스트까지 확장 가능

2. 클라우드 애플리케이션 제공자 입장에서는 애플리케이션 가용성을 높게 유지하는 것이 중요하므로, 데이터 센터 설계에 여분의 네트워크 장비와 링크를 포함
   - 예를 들어, TOR 스위치는 2개의 2단 스위치에 연결되며, 접속 라우터 / 1단 스위치 / 2단 스위치를 이중으로 구성해서 통합 가능
   - 접속 라우터 밑의 호스트들이 하나의 서브넷을 형성
   - ARP 브로드캐스트 트래픽을 지역 내로 한정하기 위해 서브넷은 다시 작은 VLAN 서브넷(수백 대 호스트들로 구성)들로 분할

3. 기존의 계층적 구조는 확장성 문제를 해결하지만 호스트-호스트 간 용량 제한하는 문제 발생
   - 위 그림에서 스위치들은 100 Gbps 이더넷 링크로 연결되어 있는 반면, 호스트는 10 Gbps 링크로 TOR 스위치에 연결되어 있다고 가정
   - 같은 랙에 있는 두 호스트는 10 Gbps 최대 속도로 항상 통신할 수 있음 (호스트의 네트워크 인터페이스 카드의 속도에 의해서만 제한)
   - 그러나 데이터 센터 네트워크에 동시에 여러 개 플로우가 있는 경우, 다른 랙에 있는 두 호스트 간 최대 전송률은 훨씬 작아질 수 있음
   - 예) 다른 랙에 있는 40개의 호스트 쌍 사이에 40개의 플로우가 동시에 존재하는 트래픽 패턴
     + 랙 1에 있는 10대의 호스트 각자가 랙 5에 있는 대응되는 호스트로 플로우를 보낸다고 가정
     + 마찬가지로, 랙 2와 6에 있는 호스트들 간에 플로우 10개, 랙 3과 랙 7 사이에 플로우 10개, 랙 4와 8 사이에 플로우 10개가 동시에 있다고 가정
     + 하나의 링크를 지나가는 플로우는 공평하게 링크 용량을 나눠서 사용하면 100 Gbps의 A에서 B로의 링크(100 Gbps의 B에서 C의 링크도)를 거쳐 가는 40개의 프롤우는 각각 100 Gbps / 40 = 2.5 Gbps만 수신하게 됨
     + 이는 10 Gbps 네트워크 인터페이스 카드 전송률보다 훨씬 작음

   - 해결 방법
     + 고속 스위치와 라우터를 사용 : 고속 포트를 갖는 스위치와 라우터는 비싸므로 데이터 센터 비용이 많이 증가
     + 2단 또는 1단 스위치를 경유하는 랙 간 통신이 최소화되도록 서로 관련된 서비스와 데이터를 가능한 한 같은 곳(예) 동일 랙이나 근처 랙)에 위치 : 데이터 센터 주요 요구사항인 계산과 서비스를 융통성 있게 배치해야 한다는 것에 제한적
       * 예를 들어, 대규모 인터넷 검색 엔진 경우, 여러 랙에 걸쳐 있는 수천대의 호스트(호스트 간 대량의 대역폭 사용)를 실행할 수 있음
       * 이 호스트들이 랙에 퍼져 있으면 네트워크 병목으로 인해 성능이 나빠질 수 있음
     + TOR 스위치들과 2단 스위치들 간, 2단 스위치들과 1단 스위치들 간 연결성을 증가
       * 하나의 TOR 스위치를 2개의 2단 스위치에 연결함으로써 랙 간의 여러 개의 링크 비결합, 스위치 비결합 경로를 제공할 수 있음
       * 첫 번째 2단 스위치와 두 번째 2단 스위치 간에 4개의 상이한 경로가 존재하며, 첫 2개의 2단 스위치 간 400 Gbps의 총 용량 제공
       * 단 간의 연결성(경로 다양성)을 증가시킴으로, 스위치 간 용량 및 신뢰성 증가라는 두 가지 이득을 얻게 됨

<div align="center">
<img src="https://github.com/user-attachments/assets/948172f3-f353-49fb-9945-009e35417b1c">
</div>

4. 데이터 센터 네트워크 단 간 연결성이 증가됨으로 다중 경로 라우팅이 우선적으로 적용될 수 있음 (기본적인 플로우는 다중 경로 플로우)
   - 다중 경로 라우팅을 실현하는 가장 단순한 바업 : ECMP(Equal Cost Multi Path)로, 출발지와 목적지 사이에 있는 스위치들을 따라가면서 임의의 다음 홉 선택을 함
   - 좀 더 세밀한 수준의 로드 밸런싱을 사용하는 향상된 기법도 제안
   - 이들 기법은 플로우 수준에서 다중 경로 라우팅을 수행하는 반면, 하나의 플로우에 속하는 개별 패킷에 대해 여러 경로 중에서 선택해서 라우팅하는 기법도 제안
