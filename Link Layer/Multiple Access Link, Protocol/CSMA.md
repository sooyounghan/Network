-----
### CSMA (Carrier Sense Multiple Access)
-----
1. 슬롯 알로하와 순수 알로하에서 노드가 전송 여부를 결정하는 것은 브로드캐스트 채널에 접속되어 있는 다른 노드의 활성 여부와 무관하며, 노드는 전송 시작 시 다른 노드의 전송 여부는 주의하지 않고, 다른 노드가 자신의 전송을 간섭하는 경우에도 자신의 전송을 중지하지 않음
2. 말하기 전에 들음 : 만일 다른 사람이 말하고 있으며, 말이 끝날 때까지 기다리는 것인데, 네트워크에서 이것을 '캐리어 감지(Carrier Sense)'라고 함
    - 즉, 노드는 전송하기 전 채널을 듣고, 만일 다른 노드가 프레임을 채널로 전송하고 있을 경우, 노드는 임의의 짧은 시간 동안 전송 중단을 감지하면 프레임을 전송하기 시작
3. 다른 사람이 동시에 말하기 시작하면 말을 중단 : 네트워크에서는 이것을 '충돌 검출(Collision Detection)'이라 함
    - 즉, 송신 노드는 전송하면서 동시에 채널을 듣는데, 만일 다른 노드가 방해 프레임을 전송하고 있음을 검출하면, 자신의 전송을 중단하고 랜덤 시간 동안 기다린 후 유휴 시 감지 및 전송 과정(Sense-and-Transmit-when-Idle Cycle) 반복
4. 위 두 규칙은 CSMA와 CSMA/CD 프로토콜에 포함
5. 모든 노드가 매체 감지를 하면 충돌 발생하는 방법
   - 노드는 다른 노드가 전송하고 있음을 감지할 때마다 자신의 전송을 억제
   - 선형 브로드캐스트 버스에 접속되어 있는 4개의 노드(A, B, C, D)에 대한 공간-시간 도표 (수평축은 각 노드의 위치, 수직축은 시간)
<div align="center">
<img src="https://github.com/user-attachments/assets/8ea81d6a-1ff5-48b3-b4ab-de26a64382f4">
</div>

   - 시간 $t_{0}$에 노드 B는 다른 노드가 아무도 전송하고 있지 않으므로 채널이 비어있는 것으로 감지
   - 따라서 노드 B는 전송을 시작하고, B가 전송한 비트들이 브로드캐스트 매체를 따라 양방향으로 전파
   - 시간이 경과함에 따라 B의 비트들이 아래쪽으로 전파 : B의 비트들이 실제로 브로드캐스트 매체로 전파할 때 0보다 큰 시간이 필요함을 의미
   - 시간 $t_{1}$ ($t_{1} > t_{0}$)에 노드 D가 전송할 프레임이 생김
     + 노드 B가 $t_{1}$에 전송하고 있음에도 불구하고, B에 의해 전송되는 비트들은 아직 D에 도달하지 못했고, 따라서 D는 $t_{1}$일 때 채널이 사용되지 않는 것으로 감지
     + 따라서, CSMA 프로토콜에 따라 D는 자신의 프레임을 전송하기 시작
   - 약간의 시간 경과 후, D에서 B가 전송한 것과 D의 전송이 간섭을 일으키기 시작
   - 즉, 브로드캐스트 채널 종단 간 채널 전파 지연(Channel Propagation Delay, 신호가 채널 한쪽 끝에서 다른 쪽 끝으로 전파되는데 걸리는 시간)이 CSMA의 성능을 결정하는데 중요 역할을 함
   - 이러한 전파 지연이 길수록 네트워크의 다른 노드에서 이미 시작된 전송을 캐리어 감지 노드가 감지할 수 없는 경우가 더 증가

-----
### CSMA/CD
-----
1. B와 D 모두 충돌이 발생했음에도 불구하고 노드들은 충돌 검출을 수행하지 않고, 자신의 프레임 전체를 계속해서 전송
2. 노드가 충돌 검출을 수행하면, 충돌이 검출되었을 때 자신의 전송 중단
3. 충돌을 검출한 뒤 두 노드가 바로 자신의 전송을 취소(Abort)
4. 다중 접속 프로토콜에서 충돌 검출을 추가하면, 쓸모없는 손상된 프레임(다른 노드로부터 프레임으로 인한 간섭 때문에 생긴 것)을 모두 전송하지 않아도 되므로 성능을 확실히 향상 가능
5. 동작 방식
   - 어댑터는 네트워크 계층으로부터 데이터그램을 받아 링크 계층 프레임을 만든 후 그 프레임을 어댑터 버퍼에 저장
   - 어댑터는 채널이 유휴(Idle) 상태임을 감지하면(즉, 채널로부터 어댑터로 들어오는 신호 에너지가 없으면) 프레임 전송을 시작하고, 어댑터가 채널이 바쁜(Busy) 상태임을 감지하면, 어떤 신호 에너지도 감지되지 않을 때까지 더 기다렸다가 프레임을 전송하기 시작
   - 전송하는 동안 어댑터는 브로드캐스트 채널을 사용하는 다른 어댑터로부터 신호 에너지가 있는지 검사
   - 프레임 전체를 전송하는 동안 다른 어댑터로부터 신호 에너지가 감지되지 않으면, 프레임 전송을 완료하지만, 전송 도중 다른 어댑터로부터의 신호 에너지를 감지하면, 자신의 프레임 전송 취소
   - 어댑터는 전송 취소 후 임의의 랜덤 시간 만큼 기다린 후 2번째 단계로 돌아감

6. 랜덤 시간 동안 기다리는 이유
   - 만일 두 노드가 동시에 프레임을 전송하고 동일한 고정 시간 동안 기다리면 계속해서 충돌하게 됨
   - 랜덤 백오프(Random Backoff) 시간을 정하는 데 사용되는 시간 간격
     + 만일 시간 간격이 크고 충돌한 노드 수가 작으면, 유휴 시 감지 및 전송 단계를 반복하기 전에 기다리는 시간(채널 유휴)이 커질 가능성이 높음
     + 반면, 시간 간격이 작고 충돌 노드가 많으면, 시간 간격을 크게 할 필요가 있음

7. DOCSIS 케이블 네트워크 다중 접속 프로토콜 뿐만 아니라 이더넷에서 사용되는 이진 지수적 백오프(Binary Exponential Backoff) 알고리즘은 이 문제를 효율적으로 해결
   - 충돌을 n번 경험한 프레임을 전송할 때, 노드는 [ $0, 1, 2, ..., 2^{n} - 1$ ] 중에서 랜덤하게 K값을 선택
   - 따라서, 충돌을 더 많이 경험할 수록 K를 선택할 간격을 크게 함
   - 이더넷의 경우, 노드가 실제로 기다리는 시간은 K ＊ 512 비트 시간(이더넷으로 512비트를 전송하는 데 필요한 시간에 K를 곱함)이 되며, n의 최댓값은 10으로 제한
<div align="center">
<img src="https://github.com/user-attachments/assets/37a96571-3ad9-420e-b8b2-5d6297330cb0">
</div>

   - 예를 들어, 노드가 처음 프레임을 전송하려고 하고, 전송 도중 충돌을 검출한다고 가정
     + 어댑터는 확률 0.5로 K = 0 또는 확률 0.5로 K = 1을 선택
     + 만일 K = 0을 선택하면, 바로 채널을 감지하기 시작하며, K = 1을 선택하면, 유휴 시 감지 및 전송 단계를 반복하기 전에 512비트의 시간(예) 100 Mbps 이더넷의 경우 5.12ms)동안 기다림
     + 두 번째 충돌 후, 같은 확률로 {0, 1, 2, 3}에서 K를 선택하고, 세 번째 충돌 후, 같은 확률로 {0, 1, 2, 3, 4, 5, 6, 7}에서 K를 선택하고, 10번이나 그 이상 충돌 후에는 같은 확률로 {0, 1, 2, ..., 1023}에서 K를 선택
   - 따라서, K를 선택하는 집합 크기는 충돌 횟수에 따라 지수적으로 증가하며, 이런 이유로 이 알고리즘을 이진 지수적 백오프
   - 노드는 전송을 위해 새 프레임을 준비할 때 최근 발생했던 충돌을 고려하지 않고 CSMA/CD 알고리즘 수행
   - 따라서, 다른 노드들이 지수적 백오프를 수행하고 있을 때, 새로운 프레임을 가진 노드가 먼저 성공적으로 전송할 수 있음

8. CSMA/CD의 효율
   - 단 하나의 노드만이 전송할 프레임이 있으면, 이 노드는 채널의 전속력으로 전송 가능
   - 그러나 많은 노드가 전송할 프레임이 있으면, 채널의 실제(Effective) 전송률은 훨씬 줄어듬
   - CSMA/CD의 효율은 오랜 시간 동안 다수의(전송할 프레임이 많은) 활성 노드들이 있을 때, 충돌 없이 프레임이 채널로 전송되는 시간 비율
   - 이더넷의 효율을 닫힌 형태의 근사적으로 표현을 위해 다음과 같이 정의
     + $d_{prop}$ : 신호 에너지가 임의의 두 어댑터 사이에서 전파되는데 걸리는 최대 시간
     + $d_{trans}$ : 최대 크기의 이더넷 프레임을 전송하는 걸리는 시간 (10Mbps 이더넷에선 대략 1.2ms)
<div align="center">
<img src="https://github.com/user-attachments/assets/df3acae0-a0e8-4597-986f-50d745d144c6">
</div>  

   - $d_{prop}$가 0에 가까우면 효율은 1에 근접 : 전파 지연이 0이 되면 충돌한 노드들이 채널을 낭비하지 않고 즉시 취소하기 때문임
   - $d_{trans}$가 아주 크면 효율은 1에 근접 : 프레임이 채널을 한 번 차지하면 아주 오랫동안 채널을 사용할 것이기 때문이므로, 채널은 거의 모든 시간 동안 유용하게 사용
