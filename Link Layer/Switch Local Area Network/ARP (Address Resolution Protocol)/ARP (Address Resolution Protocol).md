-----
### ARP (Address Resolution Protocol)
-----
1. 네트워크 계층 주소(IP 주소)와 링크 계층 주소(MAC 주소)를 변환해주는 것
2. 각 호스트와 라우터는 하나의 IP 주소와 하나의 MAC 주소를 가짐
<div align="center">
<img src="https://github.com/user-attachments/assets/06edf7d8-a9f2-4cc1-97be-8b67c563b6f4">
</div>

3. IP 주소는 점으로 구분한 십진 표기법으로 표현하고, MAC 주소는 16진 표기법으로 표현 (여기서는 스위치가 모든 프레임을 브로드캐스트한다고 가정)
   - 즉, 스위치가 한 인터페이스로 프레임을 수신하면 다른 모든 인터페이스로 프레임을 전달
4. IP 주소 ```222.222.222.220```를 가진 호스트가 호스트 ```222.222.222.222```로 IP 데이터 그램을 전송한다고 가정
   - 출발지와 목적지 노드가 동일한 서브넷에 존재
   - 데이터그램 전송을 위해, 출발지 노드는 반드시 자신의 어댑터에게 IP 데이터그램 뿐만 아니라 목적지 ```222.222.222.222```의 MAC 주소도 필요
   - 송신 어댑터는 목적지의 MAC 주소가 포함된 링크 계층 프레임을 구성해서 그 프레임을 랜으로 전송
   - 송신 호스트는 IP 주소에 대해 목적지 호스트 MAC 주소를 결정하는 방법은 ARP를 사용하는 것
   - 송신 호스트의 ARP 모듈은 입력값으로서 동일한 랜상의 임의의 IP 주소에 대해 대응되는 MAC 주소를 돌려줌
   - 이 예에서는 송신 호스트 ```222.222.222.220```이 자신의 ARP 모듈에게 ```222.222.222.222```를 주면 ARP 모듈은 대응하는 MAC 주소 ```49-BD-D2-C7-56-2A```로 응답

5. DNS와의 차이점
   - DNS는 인터넷 임의의 장소에 있는 호스트 네임을 해결
   - 💡 ARP는 동일한 서브넷 상 호스트나 라우터 인터페이스의 IP 주소만을 해결

6. 동작 방식
   - 각 호스트와 라우터는 자신의 메모리에 ARP 테이블을 가지고 있으며, IP 주소와 MAC 주소 간의 매핑 정보를 포함
   - ARP 테이블은 또한 테이블에서 각 매핑이 언제 삭제되는지 나타내는 TTL 값을 포함
   - 이 테이블에는 서브넷 상 모든 호스트와 라우터에 대한 엔트리를 갖고 있지 않아도 됨
   - 즉, 어떤 노드들에 대해 종료된 엔트리를 갖고 있을 수 있는 반면에 다른 노드들에 대한 엔트리는 테이블에 전혀 없을 수 있음
   - 일반적인 엔트리 종료 시간은 엔트리가 ARP 테이블에 들어간 후 20분
<div align="center">
<img src="https://github.com/user-attachments/assets/75b2b992-00c6-4e80-82e5-054c58bc90b5">
</div>

   - 노드 ```222.222.222.220```이 같은 서브넷의 다른 IP 주소로 가는 데이터그램을 전송하려는 상황
     + 송신 호스트는 주어진 IP 주소로부터 목적지의 MAC 주소를 획득해야만 하며, 송신 노드의 ARP 테이블에 목적지 노드에 대한 엔트리가 필요
     + 없는 경우에는, 송신 노드는 주소를 해결하기 위해 ARP 프로토콜을 사용
     + 먼저 송신 노드는 ARP 패킷이라는 특수 패킷 구성
     + ARP 패킷은 송신 및 수신 IP 주소와 MAC 주소를 모두 포함하는 필드를 가지고 있으며, ARP 질의(Query)패킷과 응답(Response) 패킷 모두 같은 형식을 가짐
     + ARP 질의 패킷의 목적은 해결하는 IP 주소에 대응하는 MAC 주소를 결정하기 위해 서브넷의 다른 모든 호스트와 라우터에게 질의

   - ```222.222.222.220```는 ARP 질의 패킷을 어댑터에게 전달하며, 어댑터에게 MAC 브로드캐스트 주소 ```FF-FF-FF-FF-FF-FF```로 패킷을 전송하도록 지시
     + 어댑터는 ARP 패킷을 링크 계층 프레임에 캡슐화하고, 이 프레임의 목적지 주소를 브로드캐스트 주소로 해서 서브넷에 전송
     + ARP 질의를 포함하는 프레임은 서브넷 상 다른 모든 어댑터에 의해 수신되며, 브로드캐스트 주소 때문에 각 어댑터는 프레임에 들어있는 ARP 패킷을 자신의 ARP 모듈로 전달
     + ARP 모듈은 자신의 IP 주소가 ARP 패킷에 들어 있는 목적지 IP 주소와 일치하는지 검사
     + 일치하는 노드는 요구된 매핑 정보가 포함된 응답 ARP 패킷을 질의한 노드로 송신
     + 그러면, 질의 호스트 ```222.222.222.220```는 자신의 ARP 테이블을 갱신하고 자신의 IP 데이터그램을 링크 계층 프레임으로 캡슐화하여 전송
     + 이 때, 프레임의 목적지 MAC 주소는 ARP 질의에 대한 응답을 보낸 호스트나 MAC 주소가 됨

7. 질의 ARP 메세지는 브로드캐스트 프레임으로 전송되는 반면, 응답 ARP 메세지는 표준 프레임으로 전송
8. ARP는 플러그 앤 플레이 방식(Plug-and-Play)
   - 노드의 ARP 테이블이 자동으로 구축
   - 시스템 관리자가 테이블을 구성하지 않아도 되며, 호스트가 서브넷으로부터 연결이 끊어지면, 이 호스트에 대한 엔트리는 그 서브넷의 다른 ARP 테이블에서 결국 제거

9. ARP 패킷은 링크 계층 프레임에 캡슐화되며, 따라서 구조적으로는 링크 계층보다 위에 존재하지만, ARP 패킷은 링크 계층 주소를 포함하는 필드들이 있고, 네트워크 계층 주소도 포함하므로 링크 계층과 네트워크 계층의 경계에 있는 프로토콜로 보는 것이 타당함

-----
### 서브넷에 없는 노드로부터 데이터그램 전송
-----
1. 어떤 서브넷에 있는 호스트가 그 서브넷에 없는, 즉, 라우터를 지나 다른 서브넷 호스트에게 네트워크 계층 데이터그램을 전송하는 경우
2. 라우터에 의해 서로 연결된 2개의 서브넷으로 구성된 단순한 네트워크
<div align="center">
<img src="https://github.com/user-attachments/assets/94e473ff-7aed-4d14-84e1-af63d1a753c7">
</div>

   - 각 호스트는 정확히 하나의 IP 주소와 하나의 어댑터를 가짐
   - 라우터는 각 인터페이스 당 하나의 IP 주소를 가지며, 각 라우터 인터페이스는 ARP 모듈(라우터 안)과 어댑터를 가짐
   - 따라서, 라우터는 2개의 인터페이스를 가지므로 2개의 IP 주소와 2개의 ARP 모듈, 2개의 어댑터를 가짐
   - 물론, 네트워크 각 어댑터는 자신만의 MAC 주소를 가짐

   - 서브넷 1은 네트워크 주소 ```111.111.111.111/24```를 가지며, 서브넷 2는 네트워크 주소 ```222.222.222.222/24```를 가짐
     + 서브넷 1에 연결된 모든 인터페이스는  ```111.111.111.xxx``` 형태의 주소를 가지며, 서브넷 2에 연결되는 모든 인터페이스는 ```222.222.222.xxx``` 형태의 주소를 가짐
   - 호스트  ```111.111.111.111```이 호스트  ```222.222.222.222```로 IP 데이터그램을 전송하려 한다고 가정
     + 송신 호스트는 평소처럼 데이터그램을 자신의 어댑터로 전달하며, 송신 호스트는 자신의 어댑터에게 적절한 목적지 MAC 주소를 전달해야 함
     + 데이터그램이 ```111.111.111.111```에서 서브넷 2에 있는 호스트로 전달되기 위해서는 먼저 데이터그램을 라우터 인터페이스 ```111.111.111.110```으로 전달해야함
     + ```111.111.111.110```는 최종 목적지로의 경로상 첫 홈(First-Hop)의 라우터 IP 주소이며, 따라서 적절한 MAC 주소는 ARP를 이용해 ```111.111.111.110```에 대한 어댑터 주소 ```E6-F9-00-17-BB-4B```가 됨
     + 송신 어댑터가 MAC 주소를 갖게 되면, 송신 어댑터는 프레임(목적지가 ```222.222.222.222```인 데이터그램을 포함)을 만들어 서브넷 1로 전송
     + 서브넷 1에 있는 라우터의 어댑터는 링크 계층 프레임이 자신을 목적지로 하는지 검사한 후, 일치한다면, 이 프레임을 라우터의 네트워크 계층으로 전달
     + 💡 라우터는 데이터그램이 전달될 정확한 인터페이스를 결정해야 하는데 라우팅 포워딩 테이블을 참조 : 포워딩 테이블은 라우터에게 데이터그램을 라우터 인터페이스 ```222.222.222.220```을 거쳐서 전달하도록 지시
     + 인터페이스는 데이터그램을 자신의 어댑터로 전달하며, 어댑터는 데이터그램을 새 프레임에 캡슐화하여 그 프레임을 서브넷 2로 전송
     + 이 때, 프레임의 목적지 MAC 주소는 실제 최종 목적지의 MAC 주소가 되며, ARP를 이용해 얻음
