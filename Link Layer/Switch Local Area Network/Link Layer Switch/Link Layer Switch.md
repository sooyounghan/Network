-----
### 링크 계층 스위치
-----
1. 스위치 : 들어오는 링크 계층 프레임을 수신해서 출력 링크로 전달
   - 그 자체가 서브넷의 호스트와 라우터에게 투명
   - 즉, 호스트 / 라우터는 프래임을 스위치가 아닌 다른 호스트 / 라우터를 목적지로 해서 랜상으로 보내며, 중간에 스위치가 프레임을 받아 다른 노드로 전달하는 것을 알지 못함
   - 또한, 프레임이 스위치 출력 인터페이스들 중 하나에 도착하는 속도가 그 인터페이스의 링크 용량을 일시적 초과 가능
   - 이 문제 해결을 위해, 라우터 출력 인터페이스가 데이터그램 버퍼를 가지듯, 스위치 출력 인터페이스도 버퍼를 가짐

2. 포워딩과 필터링
   - 필터링(Filtering) : 프레임을 인터페이스로 전달할지 또는 폐기할지 결정하는 기능
   - 포워딩(Forwarding) : 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 내보내는 기능
   - 스위치 테이블을 이용
     + 랜 상의 모든 호스트와 라우터는 아니지만, 일부 노드에 대한 엔트리 포함
     + 스위치 테이블 엔트리에는 MAC 주소 / 해당 MAC 주소로 가게 하는 스위치 인터페이스 / 해당 엔트리가 테이블에 만들어진 시점에 대한 정보 존재

3. 다수의 최신 패킷 스위치들은 2계층 MAC 주소(2계층 스위치로서 동작)나 3계층 IP 주소(3계층 라우터로서 동작)를 기반으로 전달하도록 설정될 수 있음
   - 스위치는 IP 주소가 아닌 MAC 주소 기반으로 패킷을 전달함
   - 또한, 기존 스위치 테이블이 라우팅 테이블과 다른 방식으로 구현

4. 예제 - 목적지 주소가 ```DD-DD-DD-DD-DD-DD```를 가진 프레임이 스위치 인터페이스 x에 도착했다고 가정
   - 스위치는 자신의 테이블에서 MAC 주소 ```DD-DD-DD-DD-DD-DD```를 이용해서 인덱싱
   - 가능한 3가지 경우
     + 테이블에 해당 엔트리가 없을 경우 : 스위치는 프레임의 복사본을 인터페이스 x를 제외한 모든 인터페이스 앞에 있는 출력 버퍼에 전달 (즉, 목적지 주소에 대한 엔트리가 없으면 스위치는 프레임을 브로드캐스트)
     + 테이블에 인터페이스 x와 연관된 엔트리가 존재하는 경우 : 어댑터 ```DD-DD-DD-DD-DD-DD```를 포함하는 랜 세그먼트로부터 왔으므로, 프레임을 다른 인터페이스로 전달할 필요 없이, 프레임을 제거함으로써 필터링 기능 수행
     + 테이블에 인터페이스 y ≠ x와 연관된 엔트리가 존재하는 경우 : 프레임은 인터페이스 y에 접속된 랜 세그먼트로 전달되어야 하므로, 인터페이스 y 앞에 있는 출력 버퍼에 프레임을 넣음으로 포워딩 기능 수행

5. 예제 - 목적지 주소 ```62-FE-F7-11-89-A3```을 가진 프레임이 인터페이스 1로부터 스위치에 도착했다고 가정
   - 스위치는 자신의 테이블에서 목적지가 인터페이스 1에 연결된 랜 세그먼트에 있는지 확인
   - 이는 프레임이 목적지가 있는 랜 세그먼트로 이미 브로드캐스트 되었음을 뜻하며, 따라서 스위치는 그 프레임을 필터링(폐기)
   - 똑같은 목적지 주소를 가진 프레임이 인터페이스 2로 도착했다고 가정
   - 스위치는 자신의 테이블을 참조해 목적지가 인터페이스 1쪽에 있음을 알게 됨
   - 따라서, 스위치는 프레임을 인터페이스 1의 출력 버퍼로 전달
   - 스위치 테이블이 완벽하고 정확하다면, 스위치는 프레임을 브로드캐스트하지 않고 목적지로 전달

-----
### 동작 방식
-----
1. 스위치는 자신의 테이블을 자동으로, 동적으로, 자체적으로 (네트워크 관리자나 구성의 개입 없이) 구축함
   - 스위치 테이블은 초기에 비어있음
   - 인터페이스로 수신한 각 프레임에 대해 스위치는 프레임의 출발지 주소 필드에 있는 MAC 주소와 프레임이 도착한 인터페이스, 현재 시간을 테이블에 저장
     + 이런 식으로 스위치는 테이블에 송신 노드가 상주하는 랜 세그먼트를 기록
     + 랜에 있는 모든 호스트가 프레임을 송신하면, 결국 모든 호스트에 대한 정보가 테이블에 기록
   - 일정 시간(수명 시간)이 지난 후 스위치가 해당 주소를 출발지 주소로 하는 프레임을 수신하지 못하면 테이블에서 이 주소를 삭제
     + PC가 다른 PC(상이한 어댑터를 가짐)로 대체되면, 원래 PC의 MAC 주소가 스위치 테이블에서 결국 삭제

2. 예) 시간 9:39에 출발지 주소 ```01-12-23-34-45-56```를 갖는 프레임이 인터페이스 2에 도착했다고 가정
   - 그러나 이 주소가 스위치에 없으면, 스위치는 테이블에 새로운 엔트리 추가
<div align="center">
<img src="https://github.com/user-attachments/assets/a93958b5-f980-43b8-a669-d62d06d6f07a">
</div>

   - 스위치 수명 시간이 60분이고 출발지 주소 ```62-FE-F7-11-89-A3```을 갖는 프레임이 9:32부터 10:32 사이에 도착하지 않으면, 10:32에 스위치는 테이블에서 이 주소 제거

3. 스위치는 네트워크 관리자나 사용자 개입을 요구하지 않으므로 플러그 앤 플레이 장치
   - 스위치를 설치하려는 네트워크 관리자는 랜 세그먼트를 스위치 인터페이스에 연결하는 것 이외의 일을 하지 않음
   - 네트워크 관리자는 설치할 때 호스트를 랜 세그먼트에서 제거할 때, 스위치 테이블을 구성할 필요가 없음
  
4. 또한 스위치는 전이중이며, 따라서 노드와 스위치는 이 둘 사이를 연결해주는 링크로 충돌 없이 동시 전송 가능

-----
### 링크 계층 스위치의 특성
-----
1. 충돌 제거
   - 스위치로 허브 없이 구축된 랜에는 충돌로 인해 낭비되는 대역폭이 없음
   - 스위치는 프레임을 버퍼링하며, 어느 시점이든 세그먼트에 하나 이상 프레임을 전송하지 않음
   - 라우터에서와 마찬가지로 스위치 최대 총 처리율은 모든 스위치 인터페이스 속도의 합
   - 따라서, 스위치는 브로드캐스트 링크를 사용하는 랜보다 성능이 월등히 향상

2. 이질적인 링크
   - 스위치는 링크들을 별개로 분리하므로 랜의 각 링크는 상이한 속도로 동작할 수 있으며, 상이한 매체를 사용할 수 있음
   - 스위치는 기존 장비를 새로운 장비와 함께 사용 가능

3. 관리
   - 스위치는 향상된 보안을 제공할 뿐 아니라 네트워크 관리를 쉽게 할 수 있게 해줌
   - 예를 들어, 어댑터가 오작동해서 이더넷 프레임을 계속 보내는 경우 스위치는 이 문제를 감지하고 오동작하는 어댑터(재버링 어댑터)의 연결을 의도적으로 끊음
   - 이 기능 덕분에 네트워크 관리자는 문제 해결을 할 필요가 없으며, 유사하게 케이블이 단절된 경우 이 케이블을 이용해 스위치에 연결된 호스트의 연결만 끊음
   - 스위치는 대역폭 사용, 충돌률, 트래픽 종류에 대한 통계치를 수집하며, 네트워크 관리자가 사용하도록 제공 (이 정보는 문제를 디버깅해서 정정하고, 랜을 나중에 어떻게 개선해야 할지 계획에 사용)

-----
### 스위치와 라우터
-----
1. 라우터는 네트워크 계층 주소를 사용해서 패킷을 전달하는 저장-후-전달(Store-and-Forward) 패킷 스위치
2. 비록 스위치도 저장-후-전달 패킷 스위치이지만, MAC 주소를 사용해 패킷을 전달하는 측면에서 라우터와 근본적으로 다름
3. 라우터는 3계층 패킷 스위치이며, 스위치는 2계층 스위치
   - 매치 플러스 액션 기능을 사용하는 최신 스위치들의 경우 데이터그램의 목적지 IP 주소를 기반으로 3계층 데이터그램 뿐만 아니라 프레임 목적지 MAC 주소를 기반으로 2계층 프레임을 전달
   - 실제로 OpenFlow 표준을 사용하는 스위치가 프레임, 데이터그램, 트랜스포트 계층 헤더의 11개 필드를 사용해서 일반화된 패킷 전달을 수행할 수 있음

<div align="center">
<img src="https://github.com/user-attachments/assets/94180883-40c9-4715-814d-4c25c2a44520">
</div>

4. 스위치의 장단점
   - 플러그 앤 플레이 장치
   - 상대적으로 높은 패킷 필터링 및 전달률을 가짐 (라우터는 3계층까지 프레임을 처리, 스위치는 2계층까지만 패킷 처리)
   - 브로드캐스트 프레임의 순환을 방지하기 위해 네트워크의 실제 사용되는 토폴리지는 스패닝 트리로 제한
   - 또한, 대규모 스위치 네트워크에서는 호스트와 라우터가 커다란 ARP 테이블을 갖게 되며 상당한 양의 ARP 트래픽이 생성되고 처리
   - 브로드캐스트 트래픽 폭주에 대비한 방안을 가지고 있지 않음 (만일 한 호스트가 문제가 생겨 끊임없이 이더넷 브로드캐스트 프레임을 전송하면, 스위치는 이들 프레임 모두를 전달해 전체 네트워크가 동작하지 못하도록 함)

5. 라우터의 장단점
   - 네트워크 주소체계는 MAC 주소 체계처럼 평면적이지 않고 계층 구조이므로, 네트워크에 중복된 경로가 있을 때 조차도 패킷은 라우터를 따라 순환하지 않음 (단, 라우터 테이블이 잘못 구성된 경우에는 순환 가능한데, IP는 순환을 제한하기 위해 특수 데이터그램 헤더 필드 사용)
   - 패킷은 스패닝 트리로 제한받지 않고, 출발지와 목적지 간 최상의 경로를 사용할 수 있음
   - 라우터는 스패닝 트리와 같은 제한이 없으므로, 인터넷 토폴리지가 자유롭게 구축 가능
   - 2계층에서의 브로드캐스트 폭풍에 대비한 방화벽 보호 기능 존재
   - 그러나, 플러그 앤 플레이 방법이 아님 (라우터 및 라우터에 연결된 호스트는 자신의 IP 주소가 구성되길 바람)
   - 또한, 3계층 필드까지 처리해야 하므로 스위치보다 패킷 당 처리 시간이 더 큼

6. 일반적으로 수백 개의 호스트로 구성된 네트워크는 몇 개의 랜 세그먼트를 가지므로, 작은 네트워크는 트래픽이 지역적으로 제한되어 있고 IP 주소의 구성을 요구하지 않으면서 총 처리율을 증가시키므로 스위로도 충분
7. 하지만, 보통 수천 개의 호스트로 구성된 큰 네트워크는 스위치 뿐만 아니라 라우터도 포함
   - 라우터는 트래픽을 좀 더 확실히 격리시키며, 브로드캐스트 트래픽 폭주를 제어 및 네트워크 내 호스트들 사이 더 좋은 경로 사용

<div align="center">
<img src="https://github.com/user-attachments/assets/f27b53ac-dccd-4b8b-a1cb-448a57508799">
</div>

-----
### 스위치 독(Switch Poisoning)
-----
1. 호스트가 스위치에 연결되면 보통 자신을 목적지로 해서 전송된 프레임만 수신
   - 스위치 랜에서 호스트 A가 프레임을 호스트 B로 보내고 스위치 테이블에 호스트 B에 대한 엔트리가 있으면, 스위치는 프레임을 호스트 B로만 전송
   - 호스트 C가 스니퍼(Sniffer)를 실행하고 있는 경우, 호스트 C는 A에서 B로 전달되는 프레임을 훔쳐 볼 수 없음
   - 따라서, 스위치 랜 환경(802.11 랜이나 허브 기반 이더넷 랜과 같은 브로드캐스트 링크 환경과 달리)에서는 공격자가 프레임을 훔쳐보기 어려움

2. 그러나 목적지 주소가 스위치 테이블에 없는 경우 스위치가 프레임을 브로드캐스트하므로 C의 스니퍼는 C를 목적지로 하지 않는 일부 프레임을 훔쳐볼 수 있음
   - 스니퍼는 브로드캐스트 목적지 주소 ```FF-FF-FF-FF-FF-FF```를 갖는 모든 이더넷 브로드캐스트 프레임을 훔쳐볼 수 있음
   - 스위치 독은 여러 가지 가짜 출발지 MAC 주소를 갖는 패킷을 상당수 보냄으로써 스위치 테이블을 가짜 엔트리로 가득채워 합법적 호스트들의 MAC 주소를 넣을 공간을 없애고, 스위치는 대부분의 프레임을 브로드캐스트하게 되어, 결과적으로 스니퍼가 이들 프레임을 훔쳐볼 수 있게 함
