-----
### 가상 근거리 네트워크 (VLAN)
-----
1. 스위치 랜은 스위치 계층 구조를 이용해 연결되는 형태로 계층적으로 구성되는데, 담점
   - 트래픽 격리의 부족
     + 그룹 트래픽을 단일 스위치 내로 격리해주지만, 브로드캐스트 트래픽(예) ARP 또는 DHCP 메세지를 포함하고 있는 프레임이나 자가학습 스위치에 의해 아직 목적지를 파악하지 못한 프레임들)은 여전히 전체 네트워크로 전달되어야 함
     + 브로드캐스트 트래픽의 전달 범위를 제한하면 랜 성능을 향상할 수 있음
     + 보안 / 개인보안 때문에도 랜 브로드캐스트 트래픽을 제한할 필요가 있는데, 이러한 트래픽 격리는 중앙 스위치를 라우터로 대체하면 됨

   - 스위치의 비효율적 사용
   - 사용자 관리 : 다른 스위치 연결을 위해서는 물리적 케이블 연결을 변경해야 함

2. 이러한 문제를 가상 근거리 네트워크(VLAN)를 지원하는 스위치를 사용해서 해결
   - VLAN을 지원하는 스위치는 하나의 물리적 근거리 네트워크 인프라스트럭처상에서 여러 개의 가상 근거리 네트워크들을 정의할 수 있게 함
   - VLAN에 속한 호스트들은 마치 스위치에 자신들만(다른 호스트 없이) 연결된 것처럼 서로 통신
   - 포트 기반 VLAN에서는 네트워크 관리자가 스위치 포트(인터페이스)를 그룹으로 나눔
   - 각 그룹은 하나의 VLAN을 구성하며, 한 VLAN의 포트들은 하나의 브로드캐스트 도메인을 형성 (즉, 한 포트로부터 브로드캐스트 트래픽은 그 그룹의 다른 포트에만 도달할 수 있음)

3. 16개의 포트를 갖고 있는 단일 스위치
<div align="center">
<img src="https://github.com/user-attachments/assets/9446698a-7350-4618-b1e8-9d5122006abd">
</div>

   - 포트 2 ~ 8은 EE VLAN에 속하며, 포트 9 ~ 15는 CS VLAN에 속함 (포트 1과 16은 할당되지 않음)
   - EE VLAN과 CS VLAN 프레임들을 서로 격리해주고, 2개의 스위치를 하나의 스위치로 대체하며, 스위치 포트 8에 연결된 사용자가 CS로 변경하면 네트워크 관리자가 포트 8이 CS VLAN에 속하도록 VLAN 소프트웨어 재구성
   - 네트워크 관리자는 스위치 관리 소프트웨어를 사용해 포트가 어떤 VLAN에 속하는지 선언하고(선언하지 않은 포트는 디폴트 VLAN에 속함), 포트-VLAN 매핑 테이블은 스위치에서 관리되며, 스위치 하드웨어는 같은 VLAN에 속한 포트들 간에만 프레임을 전달

4. EE VLAN에서 CS VLAN으로 트래픽을 보내는 방법 : VLAN 스위치 포트(포트 1)를 외부 라우터에 연결하고 이 포트를 EE VLAN과 CS VLAN에 모두 속하게 구성
   - EE와 CS는 같은 물리 스위치를 공유하더라도, 논리적 구성은 EE와 CS가 라우터를 통해 별도의 스위치를 갖는 것처럼 됨
   - EE에서 CS로 전송되는 IP 데이터그램은 먼저 CS VLAN을 통과해서 라우터에 도달한 후, 라우터에 의해 CS VLAN을 통해 CS 호스트로 전달
   - 스위치 생산자들은 단일 장치에 VLAN 스위치와 라우터를 모두 포함(별도 외부 라우터 필요 없음) 네트워크 관리자가 쉽게 구성 가능
  
5. 포트 8 위치가 새로 추가되었고, 이 스위치 포트들은 필요에 따라 EE VLAN 또는 CS VLAN에 속하게 하고 싶은 경우
<div align="center">
<img src="https://github.com/user-attachments/assets/6967c73a-0ebe-4263-8738-a1e2dc5a2281">
</div>

   - 각 스위치 포트 하나를 CS VLAN에 속하게 하고, 이들 포트를 서로 연결해주면 됨
   - 이 방법은 두 스위치를 연결하기 위해 N개의 VLAN이 있는 경우 스위치마다 N개의 포트들이 필요하므로 확장 문제 발생

6. VLAN 트렁킹 (VLAN Trunking)
<div align="center">
<img src="https://github.com/user-attachments/assets/6967c73a-0ebe-4263-8738-a1e2dc5a2281">
</div>

  - 스위치마다 하나의 특수 포트가 2개의 VLAN 스위치를 연결하는 트렁크 포트(Trunk Port)로 구성
  - 트렁크 포트는 모든 VLAN에 속하며, 한 VLAN에서 전송한 프레임들을 트렁크 링크를 통해 다른 스위치로 전달
  - IEEE는 VLAN 트렁크를 통과하는 프레임을 위한 확장된 형태의 이더넷 프레임 형식인 802.1Q 정의
<div align="center">
<img src="https://github.com/user-attachments/assets/551d8839-ad4c-4284-851b-85a7adc8c203">
</div>

  - 프레임이 속한 VLAN을 식별해주는 4바이트 VLAN 태그를 헤더에 갖고 있는 표준 이더넷 프레임으로 구성된 802.1Q 프레임
  - VLAN 태그는 VLAN 트렁크의 송신 측에 있는 스위치에 의해 프레임에 추가되며, 트렁크 수신 측에 있는 스위치에 의해 파싱되고 제거
  - VLAN 태그는 2바이트의 태그 프로토콜 식별자 필드(고정된 16진수 81 ~ 100을 가짐)와 2바이트 태그 제어 정보 필드(12비트의 VLAN 식별자) 필드와 3비트의 우선순위 필드(IP 데이터그램의 TOS 필드와 유사)로 구성

7. MAC 기반 VLAN의 경우 네트워크 관리자가 VLAN에 속하는 MAC 주소들을 명시 (포트에 장치가 접속되면 포트는 장치의 MAC 주소에 따라 적절한 VLAN을 연결)
8. VLAN은 네트워크 계층 프로토콜 및 다른 기준을 기반으로 해서 정의 가능
   - IP 라우터들을 거쳐 VLAN이 확장될 수 있는데, 즉 떨어져 있는 랜들을 연결해 단일 VLAN을 형성 가능
